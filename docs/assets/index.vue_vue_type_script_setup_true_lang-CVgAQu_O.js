import{d as A,a2 as G,M as O,E as a,l as H,q as J,a3 as Z,c as L,f as z,h as n,g as m,r as v,o as C,x as V,i as E,e as P,R,T as Q,J as X,a4 as Y,t as q,F as ee,b as le,V as te,a5 as ae,Z as oe,_ as se,a6 as ne,H as ue,n as ie,P as ce}from"./index-CNiyTwfQ.js";const de={key:0,style:{display:"flex","align-items":"center"}},re={class:"expand-user-dialog"},me={class:"sidebar-tree"},ve={class:"table-list"},pe={key:0,style:{display:"flex","justify-content":"center"}},fe=A({__name:"pc",props:G({showInput:{type:Boolean,default:!0},placeholder:{default:""},modelValue:{default:""},multiple:{type:Boolean,default:!1},selectAll:{type:Boolean,default:!0}},{modelValue:{},modelModifiers:{}}),emits:G(["selectClick"],["update:modelValue"]),setup(u,{expose:w,emit:N}){const i=u,c=N,p=O(u,"modelValue"),d=a(""),r=a(!1),f=()=>{r.value=!0},k=H(()=>i.modelValue,()=>{d.value="",p.value&&!d.value&&R("userGet",{id:p.value}).then(t=>{d.value=t.data.userName})}),B=()=>{p.value="",d.value=""},h=a(),U=t=>{h.value=t.id,y.value.getData()},x=(t,e)=>{R("deptList",{tid:t.data.id||0}).then(l=>{const o=l.data.list;o.forEach(g=>{g.hasChildren=!g.hasChildren}),e(o||[])})},y=a(),_=(t,e)=>(h.value&&(e.departmentId=h.value,e.status=1),e),I=J(()=>i.multiple),D=a([{prop:"selection",type:"selection",visible:I},{prop:"userName",label:"用户名称"},{label:"操作",render:"buttons",buttons:[{attr:{type:"primary",text:!0},key:"select",label:"选择",click:t=>{d.value=t.userName,p.value=t.id,r.value=!1,c("selectClick",t)}}]}]),M=a([]),S=t=>{if(t==="all")return c("selectClick",t),$(),!1;const e=y.value.getSelectionRows();e.length>0?(c("selectClick",e),$()):Q.error("请选择勾选用户")},$=()=>{r.value=!1,X(()=>{y.value.table?.clearSelection()})},F=t=>{M.value=t};return Z(()=>{k()}),w({open:f}),(t,e)=>{const l=v("el-input"),o=v("el-button"),g=v("el-tree"),T=v("ak-list"),j=v("el-dialog");return C(),L("div",null,[u.showInput?(C(),L("div",de,[n(l,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=b=>d.value=b),readonly:"",placeholder:u.placeholder,clearable:!0,onClick:e[1]||(e[1]=b=>f())},null,8,["modelValue","placeholder"]),n(o,{text:"",type:"primary",onClick:B},{default:m(()=>[...e[4]||(e[4]=[V(" 清空 ",-1)])]),_:1})])):z("",!0),n(j,{modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=b=>r.value=b),title:"用户选择","append-to-body":!0,width:"800px"},{default:m(()=>[E("div",re,[E("div",me,[n(g,{ref:"treeEl","node-key":"id",props:{label:"name",value:"id",children:"children",isLeaf:"hasChildren"},"highlight-current":"",load:x,lazy:"",onNodeClick:U},null,512)]),E("div",ve,[n(T,{ref_key:"tableListEl",ref:y,pk:"id","search-icon-visible":!1,"columns-icon-visible":!1,before:_,columns:D.value,api:{list:"userList"},onSelectionChange:F},null,8,["columns"]),u.multiple?(C(),L("div",pe,[u.selectAll?(C(),P(o,{key:0,type:"danger",onClick:e[2]||(e[2]=b=>S("all"))},{default:m(()=>[...e[5]||(e[5]=[V(" 选择全部 ",-1)])]),_:1})):z("",!0),n(o,{type:"primary",disabled:!M.value.length,onClick:S},{default:m(()=>[...e[6]||(e[6]=[V(" 确定 ",-1)])]),_:1},8,["disabled"]),n(o,{onClick:$},{default:m(()=>[...e[7]||(e[7]=[V(" 取消 ",-1)])]),_:1})])):z("",!0)])])]),_:1},8,["modelValue"])])}}}),ke={class:"h3"},he={key:0,class:"btn"},_e=A({__name:"wap",props:{modelValue:{},multiple:{type:Boolean,default:!1},data:{},showField:{type:Boolean,default:!0}},emits:["update:modelValue","selectClick"],setup(u,{expose:w,emit:N}){const i=u,c=N,p=J(()=>i.multiple||i.data.props?.multiple),d=a(0),r=a(),f=a(!1),k=a([]),B=a(!1),h=a(!1),U=a(20),x=a(1),y=a(),_=a([]),I=()=>{const e={extend:{pageSize:U.value,pageNum:x.value},userName:y.value};R("userList",e).then(l=>{const o=l.data?.total||0,g=l.data?.list||l.data||[];k.value=[...k.value,...g],f.value=!1,o<=k.value.length?B.value=!0:(B.value=!1,x.value=x.value+1),d.value=o})},D=()=>{x.value=1,k.value=[],I()},M=e=>{p.value||(r.value=e.userName,c("update:modelValue",e.id),h.value=!1,c("selectClick",e))},S=e=>{c("update:modelValue",e==="all"?"0":_.value.join(",")),h.value=!1;const l=[];k.value.forEach(o=>{_.value.includes(o.id+"")&&l.push(o.userName)}),r.value=l.join(","),c("selectClick",e==="all"?"0":_.value)},$=()=>{R("userListByIds",{ids:i.modelValue+""}).then(e=>{r.value=e.data?.map(l=>l.userName).join(",")}),p.value&&i.modelValue&&(_.value=(i.modelValue+"").split(","))},F=H(()=>i.modelValue,()=>{!k.value.length&&i.modelValue&&$()}),t=(e=!0)=>{h.value=e};return Z(()=>{F()}),w({showPopup:t}),(e,l)=>{const o=v("van-icon"),g=v("van-search"),T=v("van-checkbox"),j=v("van-cell"),b=v("van-checkbox-group"),K=v("van-list"),W=v("van-button");return C(),P(Y,{"show-picker":h.value,"onUpdate:showPicker":l[6]||(l[6]=s=>h.value=s),"model-value":r.value,item:u.data,"show-field":u.showField},{default:m(()=>[E("h3",ke,[V(" 请选择"+q(u.data.label)+" ",1),n(o,{name:"cross",size:"18px",onClick:l[0]||(l[0]=s=>h.value=!1)})]),n(g,{modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=s=>y.value=s),"show-action":"",placeholder:"请输入搜索关键词"},{action:m(()=>[E("div",{onClick:D}," 搜索 ")]),_:1},8,["modelValue"]),n(K,{loading:f.value,"onUpdate:loading":l[4]||(l[4]=s=>f.value=s),finished:B.value,"finished-text":"没有更多了",onLoad:I},{default:m(()=>[n(b,{modelValue:_.value,"onUpdate:modelValue":l[3]||(l[3]=s=>_.value=s)},{default:m(()=>[(C(!0),L(ee,null,le(k.value,s=>(C(),P(j,{key:s.id,style:te({color:s.id===u.modelValue?"red":""}),title:s.userName,onClick:ye=>M(s)},ae({_:2},[p.value?{name:"right-icon",fn:m(()=>[n(T,{name:s.id+"",onClick:l[2]||(l[2]=oe(()=>{},["stop"]))},null,8,["name"])]),key:"0"}:void 0]),1032,["style","title","onClick"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished"]),p.value?(C(),L("div",he,[n(W,{type:"warning",size:"small",onClick:l[5]||(l[5]=s=>S("all"))},{default:m(()=>[V(" 所有用户("+q(d.value)+") ",1)]),_:1}),n(W,{type:"primary",size:"small",onClick:S},{default:m(()=>[V(" 确定("+q(_.value.length)+") ",1)]),_:1})])):z("",!0)]),_:1},8,["show-picker","model-value","item","show-field"])}}}),Ce=se(_e,[["__scopeId","data-v-45598937"]]),be=A({__name:"index",emits:["selectClick"],setup(u,{expose:w,emit:N}){const i=N,c=a(),p=()=>{c.value.open()},d=()=>{c.value.showPopup()},r=f=>{i("selectClick",f)};return w({open:p,showPopup:d}),(f,k)=>(C(),P(ue(ie(ce)()?Ce:fe),ne(f.$attrs,{ref_key:"comRef",ref:c,onSelectClick:r}),null,16))}});export{be as _};
