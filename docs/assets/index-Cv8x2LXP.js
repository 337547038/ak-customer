import{d as N,r as n,c as B,o as x,w as u,k as U,i as M,a as p,g as a,h as V,b as j,D as L,E as C,I as $,m as q,z as E,e as W,j as z,F as A}from"./index-BsPutIDd.js";import{_ as G}from"./formData-InpGLguw.js";import{g as H}from"./getCityByCode-DzjNnDGo.js";import{_ as J}from"./detailTabs.vue_vue_type_script_setup_true_lang-BEz8rzmf.js";import{_ as K}from"./index.vue_vue_type_style_index_0_lang-58bUFNuy.js";import"./validate-DWZH7t8y.js";import"./areas-c4JLuV3N.js";import"./index.vue_vue_type_script_setup_true_lang-9DP-PRoD.js";import"./index.vue_vue_type_script_setup_true_lang-dl7e3Qie.js";import"./index.vue_vue_type_script_setup_true_lang-DgPMvz1G.js";import"./index.vue_vue_type_script_setup_true_lang-CmIv3eNB.js";import"./paymentForm.vue_vue_type_script_setup_true_lang-DVYNSZNY.js";import"./index.vue_vue_type_script_setup_true_lang-xzlA1xKm.js";const P=N({__name:"import",setup(y,{expose:k}){const i=n(!1),c=n(!1),o=n(),m=n(),w=n([]),T=l=>{const t=new FormData;t.append("file",l.file),i.value=!0,L("customerImport",t).then(()=>{i.value=!1,m.value&&m.value(),f(),C.success("导入成功")}).catch(()=>{i.value=!1,C.error("导入失败")})},f=()=>{o.value.clearFiles(),c.value=!1,m.value=""},b=()=>{o.value.submit()};return k({openDialog:l=>{c.value=!0,m.value=l}}),(l,t)=>{const _=p("el-button"),v=p("el-upload"),h=p("el-form-item"),S=p("el-form"),g=p("el-dialog"),D=M("loading");return x(),B(g,{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),width:"500",title:"导入客户","before-close":f},{default:u(()=>[U((x(),B(S,null,{default:u(()=>[a(h,{label:"请选择xlsx文件"},{default:u(()=>[a(v,{ref_key:"uploadRef",ref:o,"file-list":w.value,"onUpdate:fileList":t[0]||(t[0]=e=>w.value=e),accept:".xlsx","auto-upload":!1,"http-request":T},{trigger:u(()=>[a(_,{type:"primary"},{default:u(()=>[...t[2]||(t[2]=[V(" 选择文件 ",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1}),a(h,{class:"form-item-flex"},{default:u(()=>[a(_,{type:"primary",onClick:b},{default:u(()=>[...t[3]||(t[3]=[V(" 确定 ",-1)])]),_:1}),a(_,{onClick:f},{default:u(()=>[...t[4]||(t[4]=[V(" 取消 ",-1)])]),_:1})]),_:1}),a(h,{class:"form-item-flex"},{default:u(()=>[...t[5]||(t[5]=[j("a",{href:"/template.xlsx"},"下载导入模板",-1)])]),_:1})]),_:1})),[[D,i.value]])]),_:1},8,["modelValue"])}}}),Q={label:"所属人员",prop:"userId",width:100,search:{changeRefresh:!0,style:{width:"230px"},render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0},formatter:y=>y.userName},I=[{type:"selection",width:30},{label:"序号",type:"index",width:60},{prop:"company",label:"客户名称",width:240,showOverflowTooltip:!0},{prop:"type",label:"合作类型",width:150,render:"tag",replaceValue:"cooperationType",search:{render:"select",options:"cooperationType"}},{prop:"area",label:"所属区域",search:{render:"component",component:$(G)},formatter:(y,k,i)=>H(i),width:200,showOverflowTooltip:!0},{prop:"industry",label:"行业分类",width:150,render:"tag",replaceValue:"industryType",search:{render:"select",options:"industryType"}},{prop:"source",label:"来源",width:140,render:"tag",replaceValue:"source",search:{render:"select",options:"source"}},{prop:"lastTime",label:"最近联系时间",width:150,showOverflowTooltip:!0,render:"datetime",search:!1},{prop:"nextTime",label:"下次联系时间",render:"datetime",search:!1,width:150,showOverflowTooltip:!0},{prop:"creatTime",label:"创建时间",render:"datetime",search:!1,width:150,showOverflowTooltip:!0},{prop:"updateTime",label:"更新时间",width:150,showOverflowTooltip:!0,render:"datetime",search:!1},{prop:"operation",label:"操作",render:"buttons",search:!1,fixed:"right",buttons:[{key:"detail",label:"详情",icon:"",attr:{text:!0}}]}],ce=N({__name:"index",setup(y){const k=q(),i=n(),c=n(!1),o=n("default"),m=E(()=>k.userInfo?.hasChild),w=()=>{t()},T=E(()=>o.value==="child"?[...I.slice(0,3),Q,...I.slice(3)]:I),f=n(),b=n(),d=n([]),l=n(),t=()=>{b.value.getData()},_=E(()=>o.value==="shareWithMe"?[]:[{key:"add",click:()=>{g(!0)}},{key:"import",label:"导入",click:()=>{f.value.openDialog(t)},icon:"icon-import"},{key:"toUser",label:"移交",icon:"icon-toUser",click:e=>{c.value=!1,i.value.open(),d.value=e,l.value="toUser"},disabled:e=>!e?.length},{key:"toCom",label:"转入公海",icon:"icon-toCom",disabled:e=>!e?.length,click:e=>{d.value=e,l.value="toCom",v({})},render:"confirm",popConfirm:{title:"确认将所选客户转入公海吗？",width:300}},{key:"share",label:"共享客户",icon:"icon-share",disabled:e=>!e?.length,display:()=>o.value==="default",click:e=>{c.value=!0,d.value=e,l.value="myShare",i.value.open()}},{key:"cancelShare",label:"取消共享",icon:"icon-share",disabled:e=>!e?.length,display:()=>o.value==="myShare",click:e=>{d.value=e,l.value="cancelShare",v({})}},{key:"toInvalid",label:"设为无效客户",icon:"icon-invalid",render:"confirm",popConfirm:{title:"确认将所选客户设置为无效客户吗？",width:300},disabled:e=>!e?.length,click:e=>{d.value=e,l.value="toInvalid",v({})}}]),v=e=>{const r=d.value?.map(s=>s.id).join(",");if(l.value==="myShare"||l.value==="cancelShare"){let s="";l.value==="myShare"&&(s=e==="all"?"0":e?.map(R=>R.id).join(",")),L("customerShare",{ids:r,userId:s,type:l.value}).then(()=>{C.success("操作成功"),b.value.table?.clearSelection(),l.value==="cancelShare"&&t()})}else L("customerMove",{ids:r,userId:e.id,type:l.value}).then(()=>{C.success("操作成功"),t()}).catch(()=>{})},h=n(),S=(e,r)=>(e==="get"&&(r.extend.columns="contact",o.value!=="default"&&(r.extend.search=o.value)),r),g=(e,r)=>{h.value.openDrawer(e,r||{},t)},D=(e,r,s)=>{if(e==="row")switch(r.key){case"detail":g(!1,s);break}};return(e,r)=>{const s=p("el-tab-pane"),R=p("el-tabs"),F=p("ak-list");return x(),W(A,null,[a(R,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=O=>o.value=O),class:"demo-tabs",onTabChange:w},{default:u(()=>[a(s,{label:"我的客户",name:"default"}),m.value?(x(),B(s,{key:0,label:"下属客户",name:"child"})):z("",!0),a(s,{label:"共享客户",name:"shareWithMe"}),a(s,{label:"我共享的",name:"myShare"})]),_:1},8,["modelValue"]),a(F,{ref_key:"tableListEl",ref:b,pk:"id",columns:T.value,api:{list:"customerList",export:"customerExport"},"control-btn":_.value,before:S,onEventClick:D},null,8,["columns","control-btn"]),a(J,{ref_key:"detailTableRef",ref:h,"tabs-type":o.value},null,8,["tabs-type"]),a(P,{ref_key:"importDialogRef",ref:f},null,512),a(K,{ref_key:"userDialogRef",ref:i,"show-input":!1,multiple:c.value,onSelectClick:v},null,8,["multiple"])],64)}}});export{ce as default};
