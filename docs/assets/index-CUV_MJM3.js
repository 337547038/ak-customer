import{d as E,k as K,E as m,m as P,c as x,n as W,P as j,i as n,h as t,g as d,R as _,j as z,u as D,r as l,Y as F,J as G,X as J,o as V,x as k,_ as X,a8 as q}from"./index-DuawtOAE.js";import{W as Y}from"./index-BSM4qed0.js";const H=(w="login")=>{const p="wx28c54e66df42d7d1",u=encodeURIComponent(`http://192.168.10.9/#/${w}`);console.log(u);const g=Math.random().toString(36).substr(2,10);window.location.href=`https://open.weixin.qq.com/connect/oauth2/authorize?appid=${p}&redirect_uri=${u}&response_type=code&scope=snsapi_userinfo&state=${g}#wechat_redirect`},O={key:0,class:"container"},Q={class:"form"},Z=["src"],ee={class:"weixin",style:{padding:"10px 0"}},oe={key:1,class:"login-page"},te={class:"box"},se=["src"],ae={style:{margin:"16px"}},C=E({__name:"index",setup(w){const p=D(),u=z(),g=K(),h=m(),L=()=>{h.value.open()},f=(o,e)=>{e?(F("resources",!0),g.setLoginInfo(o,!0),I(o.roleId).then(()=>{const s=u.query.redirect?u.query.redirect:"/";G(()=>{p.push({path:s})})})):i()},I=o=>new Promise(e=>{if(!o)return e();_("roleGetByIds",{id:o}).then(s=>{const y=s.data;J("resources",y,0),e()})}),c=m({userName:"admin",password:"123456"}),R=m([{prop:"userName",label:"用户名",formItem:{rules:[{required:!0,message:"请输入用户名",trigger:"blur"}]},attr:{}},{prop:"password",label:"密码",formItem:{rules:[{required:!0,message:"请输入密码",trigger:"blur"}]},attr:{type:"password"}}]),v=m(),i=()=>{_("getCaptcha",{}).then(o=>{const{base64:e,codeId:s}=o.data;v.value="data:image/png;base64,"+e,c.value.codeId=s,r.value.codeId=s}).catch(()=>{})},N=()=>{const o=u.query.code,e=u.query.state;o&&e&&_("scanLogin",{code:o}).then(s=>{f(s.data,!0)}).catch(()=>{p.push({path:"/login",query:{redirect:"/system/usercenter"}}),i()})},r=m({userName:"admin",password:"123456",code:"",codeId:""}),S=()=>{H()},U=()=>{_("userLogin",r.value).then(o=>{f(o.data,!0)}).catch(()=>{i()})};return P(()=>{i(),N()}),(o,e)=>{const s=l("el-input"),y=l("el-form-item"),B=l("ak-form"),M=l("el-button"),b=l("van-field"),$=l("van-cell-group"),A=l("van-button"),T=l("van-form");return W(j)()?(V(),x("div",oe,[n("div",te,[t(T,{onSubmit:U},{default:d(()=>[e[8]||(e[8]=n("div",{class:"h1"}," AK客户管理系统 ",-1)),t($,{inset:""},{default:d(()=>[t(b,{modelValue:r.value.userName,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.userName=a),name:"username",label:"用户名",placeholder:"用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),t(b,{modelValue:r.value.password,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.password=a),type:"password",name:"password",label:"密码",placeholder:"密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"]),t(b,{modelValue:r.value.code,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.code=a),name:"password",label:"验证码",placeholder:"验证码",rules:[{required:!0,message:"请填写验证码"}]},{button:d(()=>[n("img",{src:v.value,class:"img",alt:"获取验证码",onClick:i},null,8,se)]),_:1},8,["modelValue"])]),_:1}),n("div",ae,[t(A,{round:"",block:"",type:"primary","native-type":"submit"},{default:d(()=>[...e[7]||(e[7]=[k(" 登录 ",-1)])]),_:1})]),n("div",{class:"login-type",onClick:S}," 使用微信登录 ")]),_:1})])])):(V(),x("div",O,[n("div",Q,[e[6]||(e[6]=n("h3",null,"AK客户管理系统",-1)),t(B,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),"label-width":"100",data:R.value,api:{add:"userLogin"},after:f},{default:d(()=>[t(y,{label:"验证码",class:"item-code"},{default:d(()=>[t(s,{modelValue:c.value.code,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value.code=a),placeholder:"输入验证码"},null,8,["modelValue"]),n("img",{src:v.value,class:"img",alt:"获取验证码",onClick:i},null,8,Z)]),_:1})]),_:1},8,["modelValue","data"]),n("div",ee,[t(M,{type:"primary",text:"",onClick:L},{default:d(()=>[...e[5]||(e[5]=[k(" 微信扫码登录 ",-1)])]),_:1})]),t(Y,{ref_key:"wxLoginRef",ref:h},null,512)])]))}}});typeof q=="function"&&q(C);const le=X(C,[["__scopeId","data-v-f5cdc8ff"]]);export{le as default};
