import{d as le,k as ne,E as o,aa as ue,q as ce,j as ie,c as S,h as u,g as s,F as P,r as l,o as m,e as g,f as q,i as n,t as c,x as C,$ as de,b as pe,S as me,J as T,_ as fe}from"./index-CkpV00AO.js";import{_ as ve}from"./upload.vue_vue_type_script_setup_true_lang-Cpmhnit_.js";import{_ as _e}from"./payFormWap.vue_vue_type_script_setup_true_lang-D4312fy5.js";import"./validate-DSwcNQEl.js";const ye=["onClick"],ke={class:"ul"},he={style:{width:"100%"}},Ie={style:{width:"100%"}},be={class:"form-title"},xe=le({__name:"wap",props:{formData:{}},setup(U){const A=U,k=ne(),D=ie(),f=o(!1),N=o(),v=o(!1),h=o(!1),I=o(["status"]),_=o(),V=o([]),B={1:"待审核",2:"已确认",3:"未通过"},E=k.userInfo?.hasChild,b=o(),p=ue({customerId:"",userId:""}),W=ce(()=>{const e=[];return A.formData.forEach(t=>{let r=t.render==="radio"?"picker":t.render,d={};switch(t.prop){case"customerId":r="picker",d={picker:{remote:!0,keyword:"company",ajax:{api:"customerList",data:{userId:p.userId}},columnsFieldNames:{text:"company",value:"id"}}};break;case"contactId":r="picker",d={picker:{remote:!0,openLoad:!0,keyword:"name",ajax:{api:"contactList",data:{tid:p.customerId,userId:p.userId}},columnsFieldNames:{text:"name",value:"id"}}};break;case"remark":d={field:{type:"textarea"}};break;case"status":r="picker",d={picker:{columnsFieldNames:{text:"label",value:"value"}}};break}e.push({label:t.label,prop:t.prop,rules:t.formItem?.rules||[],render:r,options:t.options,...d})}),e}),z=e=>{b.value=e},x=(e,t)=>me(e,t==="d"?"{y}-{m}-{d}":"{y}-{m}-{d} {h}:{i}"),G=e=>[{text:"审核",key:"check",type:"warning",visible:()=>E&&e.userId!==k.userInfo?.id&&e.status===1},{text:"收款",key:"money",type:"success"},{text:"编辑",key:"edit",type:"primary"},{text:"删除",key:"del",type:"danger"}].filter(t=>typeof t.visible=="function"?t.visible()!==!1:!0),J=(e,t)=>{t==="del"?_.value.deleteById(e.id):t==="edit"||t==="check"?$(e,t):(f.value=!0,T(()=>{N.value.setValue({contractId:e.id})}))},L=o(),M=o([{label:"所属人员",prop:"userId",render:"picker",visible:()=>E,field:{clearable:!0},picker:{ajax:{api:"userChildList",data:{}},columnsFieldNames:{text:"userName",value:"id"}}},{prop:"code",label:"合同编号"},{prop:"name",label:"合同名称"},{label:"客户名称",prop:"customerId",field:{clearable:!0},render:"picker",modelValue:D.query.id,picker:{remote:!0,openLoad:!0,keyword:"company",ajax:{api:"customerList",data:{userId:L}},columnsFieldNames:{text:"company",value:"id"}}},{prop:"startEndDate",label:"合同有效期",render:"datePicker",datePicker:{type:"dateRange",startPlaceholder:"合同开始时间",endPlaceholder:"合同结束时间"}},{prop:"status",label:"状态",render:"picker",options:{1:"待审核",2:"已确认",3:"未通过"}}]),H=(e,t,r)=>{e==="userId"&&(r.customerId=""),L.value=t},w=o(!0),y=o("新增合同"),K=e=>{e==="add"&&(w.value=!0)},O=e=>{if(e.customerId||(e.customerId=D.query.id),e.startEndDate){const t=e.startEndDate.split(",");e.startDate=t[0],e.endDate=t[1],delete e.startEndDate}return e},R=o(),$=(e,t)=>{w.value=!1,v.value=!1,h.value=!1,I.value=["status"],e.status===2&&e.userId===k.userInfo.id&&(v.value=!0,h.value=!0),t==="edit"?y.value=`编辑：${e.name} 信息`:t==="check"?(y.value=`审核：${e.name} 信息`,I.value=[]):(y.value=`查看：${e.name} 信息`,v.value=!0),p.userId=e.userId,p.customerId=e.customerId,F(!0),T(()=>{R.value.getData({id:e.id})})},Q=(e,t,r)=>{e==="customerId"&&(r.contactId="",p.customerId=t)},F=e=>{_.value.showForm(e)},X=e=>(b.value&&(e.files=b.value),e),Y=e=>{e==="submit"&&(_.value.onRefresh(),F(!1))};return(e,t)=>{const r=l("van-tag"),d=l("van-collapse-item"),Z=l("van-button"),j=l("van-swipe-cell"),ee=l("van-notice-bar"),te=l("w-form"),ae=l("w-list"),oe=l("van-collapse"),se=l("van-icon"),re=l("van-popup");return m(),S(P,null,[u(oe,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=a=>V.value=a)},{default:s(()=>[u(ae,{ref_key:"listRef",ref:_,api:{get:"contractList",del:"contractDel"},"search-form-data":M.value,"add-icon-visible":!0,"form-title":y.value,before:O,onSearchFormChange:H,onNavBarEvent:K},{item:s(({data:a})=>[u(j,null,{right:s(()=>[(m(!0),S(P,null,pe(G(a),i=>(m(),g(Z,{key:i.key,square:"",color:i.color,type:i.type,text:i.text,size:"small",onClick:we=>J(a,i.key)},null,8,["color","type","text","onClick"]))),128))]),default:s(()=>[u(d,{name:a.id,value:a.code},{title:s(()=>[n("div",{onClick:de(i=>$(a),["stop"])},[C(c(a.name)+" ",1),a.status?(m(),g(r,{key:0,type:a.status===1?"danger":a.status===2?"success":"primary"},{default:s(()=>[C(c(B[a.status]),1)]),_:2},1032,["type"])):q("",!0)],8,ye)]),default:s(()=>[n("ul",ke,[n("li",he," 客户名称："+c(a.customerName),1),n("li",null,"合同金额："+c(a.money),1),n("li",null,"公司签约人："+c(a.contactName),1),n("li",null,"已收款项："+c(a.payment||0),1),n("li",null,"状态："+c(B[a.status]),1),n("li",Ie," 合同有效期："+c(x(a.startDate,"d")+" / "+x(a.endDate,"d")),1),n("li",null,"创建时间："+c(x(a.creatDate)),1)])]),_:2},1032,["name","value"])]),_:2},1024)]),default:s(()=>[u(te,{ref_key:"formRef",ref:R,disabled:v.value,data:W.value,"submit-url":w.value?"contractSave":"contractEdit","request-url":"contractGet",before:X,after:Y,"hide-filed":I.value,onCancel:F,onFieldValueChange:Q},{formTop:s(()=>[h.value?(m(),g(ee,{key:0,text:"审核通过，不能修改数据"})):q("",!0)]),files:s(({rows:a,value:i})=>[u(ve,{item:a,"model-value":i,"onUpdate:modelValue":z},null,8,["item","model-value"])]),_:1},8,["disabled","data","submit-url","hide-filed"])]),_:1},8,["search-form-data","form-title"])]),_:1},8,["modelValue"]),u(re,{show:f.value,"onUpdate:show":t[2]||(t[2]=a=>f.value=a),position:"right","destroy-on-close":!0,style:{width:"88%",height:"100%"}},{default:s(()=>[n("div",be,[t[3]||(t[3]=C(" 添加回款 ",-1)),u(se,{name:"cross",onClick:t[1]||(t[1]=a=>f.value=!1)})]),u(_e,{ref_key:"payFormRef",ref:N},null,512)]),_:1},8,["show"])],64)}}}),Ne=fe(xe,[["__scopeId","data-v-f30d7b62"]]);export{Ne as default};
