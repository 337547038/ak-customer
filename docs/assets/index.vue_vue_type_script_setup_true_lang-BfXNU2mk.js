import{_ as g}from"./index.vue_vue_type_script_setup_true_lang-CvW6n_1L.js";import{_ as x}from"./index.vue_vue_type_script_setup_true_lang-D-Hmp8yO.js";import{v as c}from"./validate-DWWidr2n.js";import{d as G,k as Q,a6 as W,E as a,q as n,Q as u,c as z,h,g as F,n as i,r as b,o as A,i as T,t as D,S as J}from"./index-DuawtOAE.js";const K={style:{padding:"0 20px","margin-bottom":"8px"}},X={style:{padding:"0 20px"}},re=G({__name:"index",props:{company:{default:""},keyColumns:{default:""}},setup(I,{expose:V}){const N=I,k=Q(),o=W("detailTabsProps",a({})),Y=[{key:"add",click:()=>{L()},display:()=>!o.value.disabled}],y=a(),d=a(!1),w=a("新增联系人"),C=a(),l=a({}),M=n(()=>o.value.customerId||l.value.customerId),E=(e,t)=>(e==="get"&&o.value.isComponents&&(t.customerId=o.value.customerId,t.userId=o.value.userId,o.value.tabsName==="shareWithMe"&&(t.specialCustomer=o.value.customerId,t.extend.search="comInvalidShare")),t),L=(e,t)=>{d.value=!0,w.value=`新增${N.company||""}跟进`},m=n(()=>!o.value.isComponents),S=n(()=>o.value.isComponents?o.value.tabsName==="child":k.userInfo?.hasChild),p=a({}),f=n(()=>o.value.userId||p.value?.userId),q=n(()=>o.value.isComponents?o.value.customerId:p.value.customerId),B=a([{type:"expand",prop:"expand",search:!1,width:30},{prop:"checked",type:"selection"},{label:"所属人员",prop:"userId",visible:!1,search:{changeRefresh:!0,style:{width:"230px"},visible:S,render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0}},{label:"客户名称",prop:"customerId",search:{userId:f,visible:m,render:"component",component:u(g)},formatter:e=>e.company,visible:m,showOverflowTooltip:!0},{label:"联系人",prop:"contactId",width:90,search:{userId:f,customerId:q,placeholder:"请输入联系人,可使用%",render:"component",component:u(x)},formatter:e=>e.contactName},{label:"跟进方式",prop:"type",render:"tag",width:110,replaceValue:"followType",search:{render:"select",options:"followType"}},{prop:"dateTime",label:"创建时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"userName",label:"跟进人",search:!1,width:90},{prop:"remark",label:"跟进内容",search:!1,formatter:e=>e.remark.length>20?e.remark?.substring(0,20)+"...":e.remark},{visible:()=>!o.value.disabled,width:90,prop:"operate",label:"操作",render:"buttons",search:!1,buttons:[{key:"del",label:"删除",icon:"",attr:{text:!0}}]}]),v=()=>{d.value=!1,l.value={},C.value.resetFields()},H=(e,t)=>(t==="add"&&o.value.isComponents&&(e.customerId=o.value.customerId),e),R=(e,t,r)=>(["add","update"].includes(r)&&(v(),_()),e),U=a([{label:"客户名称",prop:"customerId",attr:{},render:"component",component:u(g),visible:m,formItem:{rules:[c("required","客户名称不能为空","change")]}},{label:"联系人",prop:"contactId",attr:{placeholder:"请输入联系人,可使用%",customerId:M,userId:f,onBlur:(e,t)=>{l.value.contactName=t}},render:"component",component:u(x),formItem:{rules:[c("required","联系人不能为空","change")]}},{label:"跟进方式",prop:"type",render:"select",options:"followType",formItem:{rules:[c("required","请选择跟进方式")]}},{label:"下次跟进时间",prop:"nextTime",render:"datePicker",attr:{type:"datetime",valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss"}},{label:"跟进内容",prop:"remark",attr:{style:{width:"100%"},type:"textarea",rows:3},formItem:{rules:[c("required","请输入跟进内容")]}}]),P=(e,t,r)=>{e==="customerId"&&t&&(r.contactId=void 0)},$=(e,t,r)=>{e==="userId"&&k.userInfo?.hasChild&&(r.customerId=null,r.contactId=void 0),e==="customerId"&&(r.contactId=void 0),p.value=r},_=()=>{y.value.getData()};return V({getData:_}),(e,t)=>{const r=b("ak-list"),j=b("ak-form"),O=b("el-dialog");return A(),z("div",null,[h(r,{ref_key:"tableListEl",ref:y,pk:"id",columns:B.value,api:{list:"followList",del:"followDel"},"control-btn":Y,before:E,"auto-load":!i(o).isComponents,"show-search":!i(o).disabled,"columns-icon-visible":!i(o).disabled,"key-columns":I.keyColumns,onFormFieldChange:$},{expand:F(({row:s})=>[T("div",K," 跟进时间："+D(i(J)(s.dateTime)),1),T("div",X," 跟进内容："+D(s.remark),1)]),_:1},8,["columns","auto-load","show-search","columns-icon-visible","key-columns"]),h(O,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=s=>d.value=s),width:"800",title:w.value,class:"form-dialog","before-close":v},{default:F(()=>[h(j,{ref_key:"formRef",ref:C,modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s),pk:"id",data:U.value,"label-width":"100",class:"flex-form flex-form-2",api:{detail:"followGet",add:"followSave"},after:R,before:H,onCancel:v,onChange:P},null,8,["modelValue","data"])]),_:1},8,["modelValue","title"])])}}});export{re as _};
