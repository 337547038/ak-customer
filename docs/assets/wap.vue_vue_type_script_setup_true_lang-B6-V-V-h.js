import{d as U,k as $,E as a,q as H,j as J,e as w,g as r,r as s,o as f,h as d,i,t as c,c as K,b as M,F as O,S as Q}from"./index-CkpV00AO.js";import{v as p}from"./validate-DSwcNQEl.js";const W={class:"ul"},te=U({__name:"wap",setup(X){const v=J(),y=$(),x=y.userInfo?.hasChild,_=a([]),u=a(),F=a(!0),C=a("新增跟进记录"),m=a(),k=a(),g=H(()=>y.getSystemDict()||{}),I=e=>Q(e,"{y}-{m}-{d} {h}:{i}"),L=a([{label:"所属人员",prop:"userId",render:"picker",visible:()=>x,field:{clearable:!0},picker:{ajax:{api:"userChildList",data:{}},columnsFieldNames:{text:"userName",value:"id"}}},{label:"客户名称",prop:"tid",field:{clearable:!0},render:"picker",modelValue:v.query.id,picker:{remote:!0,openLoad:!0,keyword:"company",ajax:{api:"customerList",data:{userId:m}},columnsFieldNames:{text:"company",value:"id"}}},{label:"联系人",prop:"name",field:{clearable:!0},render:"picker",picker:{remote:!0,openLoad:!0,keyword:"name",ajax:{api:"contactList",data:{userId:m,customerId:k}},columnsFieldNames:{text:"name",value:"id"}}},{label:"跟进方式",prop:"type",render:"picker",options:"followType"}]),N=e=>(e.tid||(e.tid=v.query.id),e),B=(e,l,n)=>{e==="userId"&&(n.tid="",m.value=l),e==="tid"&&(k.value=l,n.name="")},q=e=>{e==="add"&&(F.value=!0)},S=[{text:"删除",key:"del",type:"danger"}],V=(e,l)=>{l==="del"&&u.value.deleteById(e.id)},b=a(),j=(e,l,n)=>{e==="customerId"&&(b.value=l,n.contactId="")},D=a([{label:"客户名称",prop:"customerId",field:{clearable:!0},render:"picker",picker:{remote:!0,keyword:"company",ajax:{api:"customerList",data:{}},columnsFieldNames:{text:"company",value:"id"}},rules:[p("required","客户名称不能为空")]},{label:"联系人",prop:"contactId",field:{clearable:!0},render:"picker",picker:{remote:!0,keyword:"name",openLoad:!0,ajax:{api:"contactList",data:{tid:b}},columnsFieldNames:{text:"name",value:"id"}},rules:[p("required","联系人不能为空")]},{label:"跟进方式",prop:"type",render:"picker",options:"followType",rules:[p("required","请选择跟进方式")]},{label:"下次跟进时间",prop:"nextTime",render:"datePicker",datePicker:{type:"datetime"}},{label:"跟进内容",prop:"remark",field:{type:"textarea"},rules:[p("required","请输入跟进内容")]}]),T=e=>{e==="submit"&&(u.value.onRefresh(),h(!1))},R=a([]),h=e=>{u.value.showForm(e)};return(e,l)=>{const n=s("van-collapse-item"),E=s("van-button"),A=s("van-swipe-cell"),P=s("w-form"),z=s("w-list"),G=s("van-collapse");return f(),w(G,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=t=>_.value=t)},{default:r(()=>[d(z,{ref_key:"listRef",ref:u,api:{get:"followList",del:"followDel"},"search-form-data":L.value,"add-icon-visible":!0,"form-title":C.value,before:N,onSearchFormChange:B,onNavBarEvent:q},{item:r(({data:t})=>[d(A,null,{right:r(()=>[(f(!0),K(O,null,M(S.filter(o=>o.visible!==!1),o=>(f(),w(E,{key:o.key,square:"",color:o.color,type:o.type,text:o.text,size:"small",onClick:Y=>V(t,o.key)},null,8,["color","type","text","onClick"]))),128))]),default:r(()=>[d(n,{name:t.id,value:t.company},{title:r(()=>[i("div",null,c(t.contactName),1)]),default:r(()=>[i("ul",W,[i("li",null,"跟进方式："+c(g.value.followType[t.type]),1),i("li",null,"跟进时间："+c(I(t.dateTime)),1),i("li",null,"跟进人："+c(t.userName),1),i("li",null,"跟进内容："+c(t.remark),1)])]),_:2},1032,["name","value"])]),_:2},1024)]),default:r(()=>[d(P,{ref:"formRef",data:D.value,"submit-url":"followSave","request-url":"followGet",after:T,"hide-filed":R.value,onCancel:h,onFieldValueChange:j},null,8,["data","hide-filed"])]),_:1},8,["search-form-data","form-title"])]),_:1},8,["modelValue"])}}});export{te as _};
