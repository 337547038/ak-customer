import{d as z,l as n,c as I,o as s,f as p,i as te,F as O,b as P,e as c,r as v,g as r,v as B,t as A,h as f,D as U,E as le,k as se,s as R,z as M,q as oe,J as S,L as ne}from"./index-CyV0dc7F.js";import{_ as re}from"./index.vue_vue_type_script_setup_true_lang-BGBWymDp.js";import{f as q}from"./formData-C63m_dsP.js";import{_ as ue,a as de}from"./index.vue_vue_type_script_setup_true_lang-5kPTWdgv.js";import{_ as ie}from"./index.vue_vue_type_script_setup_true_lang-pNcDpwYM.js";const me={key:0},ce={key:1},fe={key:2,style:{"padding-top":"15px"}},pe=z({__name:"shareInfo",props:{userIds:{},customerId:{},disabled:{type:Boolean}},emits:["update:userIds","change"],setup(x,{expose:w,emit:g}){const h=x,V=g,i=n([]),u=()=>{h.userIds&&U("userListByIds",{ids:h.userIds}).then(l=>{i.value=l.data})},T=(l,a)=>{i.value.splice(a,1);const d=i.value.map(_=>_.id).join(",");b(d,"share")},b=(l,a)=>{U("customerShare",{ids:h.customerId,userId:l,type:a}).then(d=>{le.success("操作成功"),V("update:userIds",l),l===""&&V("change")})};return w({getData:u}),(l,a)=>{const d=v("el-tag"),_=v("el-button");return s(),I("div",null,[l.userIds==="0"?(s(),I("div",me,"当前客户已共享给所有人")):i.value?(s(),I("div",ce,[a[1]||(a[1]=te("p",{style:{"padding-bottom":"15px"}},"当前客户已共享给:",-1)),(s(!0),I(O,null,P(i.value,(m,C)=>(s(),c(d,{key:m.id,closable:!l.disabled,style:{"margin-right":"5px"},onClose:F=>T(m,C)},{default:r(()=>[B(A(m.userName),1)]),_:2},1032,["closable","onClose"]))),128))])):p("",!0),l.disabled?p("",!0):(s(),I("div",fe,[f(_,{type:"danger",onClick:a[0]||(a[0]=m=>b("","cancelShare"))},{default:r(()=>[...a[2]||(a[2]=[B("取消分享",-1)])]),_:1})]))])}}}),Ie=z({__name:"detailTabs",props:{disabled:{type:Boolean},tabsType:{}},setup(x,{expose:w}){const g=x,h=se(),V=R(()=>h.userInfo?.id),i=R(()=>g.tabsType==="shareWithMe"),u=n({}),T=n(),b=n("detail"),l=n(!1),a=n({}),d=n(!0),_=n(),m=n(),C=()=>{l.value=!1,m.value&&m.value(),M(()=>{u.value={},b.value="detail",D.value=[],m.value=void 0})},F=(e,t,y)=>{l.value=!0,d.value=e,a.value=t,m.value=y,e?_.value="新增客户":(_.value=t.company+"详情",M(()=>{T.value.getData({id:t.id})}))},J=R(()=>({userId:a.value.userId,customerId:a.value.id,isComponents:!0,tabsName:g.tabsType,disabled:g.disabled||i.value}));ne("detailTabsProps",J);const $=n(),L=n(),j=n(),E=n(),W=e=>{switch(e){case"follow":j.value.getData();break;case"contact":$.value.getData();break;case"contract":L.value.getData();break;case"operate":Q();break;case"share":E.value.getData();break}},G=(e,t)=>(["add","update"].includes(t)&&e.area&&(e.area=e.area.join(",")),e),H=(e,t,y)=>(["add","update"].includes(y)?C():y==="detail"&&(e.lastTime=S(a.value.lastTime),e.nextTime=S(a.value.nextTime),e.area&&(e.area=e.area.split(","))),e),K=R(()=>d.value?q.filter(e=>e.visible!=="isDetailForm"):q),D=n([]),Q=()=>{a.value.id&&D.value.length===0&&U("customerRecords",{tid:a.value.id}).then(e=>{D.value=e.data.list||[]})},X=()=>{b.value="detail"};return w({openDrawer:F}),(e,t)=>{const y=v("ak-form"),k=v("el-tab-pane"),Y=v("el-timeline-item"),Z=v("el-timeline"),ee=v("el-tabs"),ae=v("el-drawer");return s(),c(ae,{modelValue:l.value,"onUpdate:modelValue":t[4]||(t[4]=o=>l.value=o),size:"88%",title:_.value,"before-close":C},{default:r(()=>[f(ee,{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=o=>b.value=o),onTabChange:W},{default:r(()=>[f(k,{label:"客户详情",name:"detail"},{default:r(()=>[f(y,{ref_key:"formRef",ref:T,pk:"id","label-width":"100",class:"flex-form flex-form-2",onCancel:C,after:H,data:K.value,before:G,disabled:e.disabled||i.value,api:{detail:"customerDetail",add:"customerSave",edit:"customerEdit"},modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=o=>u.value=o)},{files:r(({rows:o})=>[l.value?(s(),c(ue,{key:0,prop:o.prop,label:o.label,modelValue:u.value.files,"onUpdate:modelValue":t[0]||(t[0]=N=>u.value.files=N)},null,8,["prop","label","modelValue"])):p("",!0)]),_:1},8,["data","disabled","modelValue"])]),_:1}),d.value?p("",!0):(s(),c(k,{key:0,label:"跟进记录",name:"follow"},{default:r(()=>[f(ie,{ref_key:"followRef",ref:j,keyColumns:"customerFollow",company:a.value.company},null,8,["company"])]),_:1})),d.value?p("",!0):(s(),c(k,{key:1,label:"联系人",name:"contact"},{default:r(()=>[f(re,{keyColumns:"customerContact",company:a.value.company,ref_key:"contactRef",ref:$},null,8,["company"])]),_:1})),d.value?p("",!0):(s(),c(k,{key:2,label:"合同",name:"contract"},{default:r(()=>[f(de,{keyColumns:"customerContract",ref_key:"contractRef",ref:L},null,512)]),_:1})),d.value?p("",!0):(s(),c(k,{key:3,label:"操作记录",name:"operate"},{default:r(()=>[f(Z,null,{default:r(()=>[(s(!0),I(O,null,P(D.value,(o,N)=>(s(),c(Y,{key:N,timestamp:o.userName+o.content},{default:r(()=>[B(A(oe(S)(o.dataTime)),1)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})),u.value?.userId===V.value&&u.value.shareUserId?(s(),c(k,{key:4,label:"分享详情",name:"share"},{default:r(()=>[f(pe,{disabled:e.disabled||i.value,ref_key:"shareInfoRef",ref:E,userIds:u.value.shareUserId,"onUpdate:userIds":t[2]||(t[2]=o=>u.value.shareUserId=o),"customer-id":a.value.id,onChange:X},null,8,["disabled","userIds","customer-id"])]),_:1})):p("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}});export{Ie as _};
