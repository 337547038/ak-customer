import{d as he,k as ke,q as _,E as s,Q as _e,c as Q,h as a,w as V,g as o,G as B,F as Z,r as i,o as h,e as S,f as F,i as n,x as f,t as u,n as ge,Z as H,b as Ce,S as xe,R as we,$ as Se,u as Re,J as X,_ as Te}from"./index-CNiyTwfQ.js";import{_ as $e,f as Ie}from"./formData-D8zts8VD.js";import{g as De}from"./getCityByCode-DzjNnDGo.js";import{_ as Ve}from"./index.vue_vue_type_script_setup_true_lang-CVgAQu_O.js";import{_ as Be}from"./upload.vue_vue_type_script_setup_true_lang-COSkoUoB.js";import{R as Fe,S as Ue}from"./records-C3xKnzZs.js";import"./validate-BPUuIrlQ.js";import"./areas-c4JLuV3N.js";const ze=["onClick"],Ne={class:"ul"},Me={class:"btn-group"},qe=he({__name:"wap",setup(We){const U=Re(),z=ke(),Y=_(()=>z.userInfo?.hasChild),R=_(()=>z.getSystemDict()||{}),b=s(),N=s("新增客户"),g=s(!0),M=s(),m=s(!1),C=t=>xe(t,"{y}-{m}-{d} {h}:{i}"),d=s([]),T=s([]),r=s("default"),j=()=>{b.value.onRefresh(),m.value=!1,T.value=[]},ee=t=>(t.extend.columns="contact",r.value!=="default"&&(t.extend.search=r.value),t),te=s([{prop:"userId",label:"下属用户",render:"picker",visible:()=>r.value==="child",picker:{ajax:{api:"userChildList",data:{}},columnsFieldNames:{text:"userName",value:"id"}}},{prop:"company",label:"客户名称"},{prop:"type",label:"合作类型",render:"picker",options:"cooperationType"},{prop:"area",label:"所属区域",render:"component",component:_e($e)},{prop:"industry",label:"行业分类",render:"picker",options:"industryType"},{prop:"source",label:"来源",render:"picker",options:"source"}]),le=t=>{t==="add"&&(g.value=!0)},q=s(),W=s(),k=s(),E=s(!1),L=t=>{E.value=t==="myShare",W.value.showPopup(),k.value=t},$=t=>{k.value=t,A({})},A=t=>{const e=d.value.join(",");let v=t?.id,w="customerMove";["myShare","cancelShare"].includes(k.value)&&(["myShare"].includes(k.value)&&(v=t==="0"?"0":t?.join(",")),w="customerShare"),we(w,{ids:e,userId:v,type:k.value}).then(()=>{Se("操作成功"),b.value.onRefresh(),m.value=!1,d.value=[]})},P=t=>{D(!0),g.value=!1,N.value="编辑/查看客户："+t.company,X(()=>{M.value.getData({id:t.id})})},I=s(),G=_(()=>g.value?["creatTime","updateTime","lastTime","nextTime"]:[]),ae=t=>{I.value=t},oe=_(()=>Ie.filter(t=>!G.value.includes(t.prop)).map(t=>{const e=Object.assign({},t);return e.formItem&&(e.rules=e.formItem?.rules||[],delete e.formItem),e.attr&&(e.field=e.attr,delete e.attr),e.visible&&delete e.visible,e.render==="select"&&(e.render="picker"),e})),se=t=>(I.value&&(t.files=I.value),t),ne=t=>{t==="submit"&&(b.value.onRefresh(),D(!1))},D=t=>{b.value.showForm(t)},J=s(),K=s(),x=s(!1),y=s({ids:"",customer:""}),re=_(()=>[{text:"详情",key:"detail",color:"rgb(84, 112, 198)"},{text:"跟进记录",key:"follow",color:"rgb(145, 204, 117)"},{text:"联系人",key:"contact",color:"rgb(250, 200, 88)"},{text:"合同",key:"contract",color:"rgb(238, 102, 102)"},{text:"操作记录",key:"record",color:"rgb(115, 192, 222)"},{text:"分享详情",key:"share",color:"rgb(234, 124, 204)",visible:r.value==="myShare"}]),ie=(t,e)=>{switch(e){case"detail":P(t);break;case"record":J.value.getData(t.id);break;case"share":x.value=!0,y.value.ids=t.shareUserId,y.value.customer=t.id,X(()=>{K.value.getData()});break;case"contract":U.push({path:`/contract/${e}`,query:{id:t.id}});break;default:U.push({path:`/customer/${e}`,query:{id:t.id}})}},O=()=>{x.value=!1,y.value.ids="",y.value.customer="",b.value.onRefresh()};return(t,e)=>{const v=i("van-tab"),w=i("van-tabs"),ue=i("van-checkbox"),de=i("van-collapse-item"),p=i("van-button"),ce=i("van-swipe-cell"),me=i("w-form"),ve=i("w-list"),pe=i("van-checkbox-group"),fe=i("van-collapse"),be=i("van-action-bar"),ye=i("van-popup");return h(),Q(Z,null,[a(w,{active:r.value,"onUpdate:active":e[1]||(e[1]=l=>r.value=l),onChange:j},{"nav-right":o(()=>[V(n("div",{class:"manage-btn",onClick:e[0]||(e[0]=l=>m.value=!m.value)},[e[13]||(e[13]=n("i",{class:"icon-manage"},null,-1)),f(" "+u(m.value?"完成":"管理"),1)],512),[[B,r.value!=="shareWithMe"]])]),default:o(()=>[a(v,{title:"我的客户",name:"default"}),Y.value?(h(),S(v,{key:0,title:"下属客户",name:"child"})):F("",!0),a(v,{title:"共享客户",name:"shareWithMe"}),a(v,{title:"我共享的",name:"myShare"})]),_:1},8,["active"]),a(fe,{modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=l=>T.value=l)},{default:o(()=>[a(pe,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=l=>d.value=l)},{default:o(()=>[a(ve,{ref_key:"listRef",ref:b,api:{get:"customerList"},"search-form-data":te.value,"add-icon-visible":!0,"form-title":N.value,before:ee,onNavBarEvent:le},{item:o(({data:l})=>[a(ce,null,{right:o(()=>[(h(!0),Q(Z,null,Ce(re.value.filter(c=>c.visible!==!1),c=>(h(),S(p,{key:c.key,square:"",color:c.color,text:c.text,size:"small",onClick:Ee=>ie(l,c.key)},null,8,["color","text","onClick"]))),128))]),default:o(()=>[a(de,{name:l.id,value:r.value==="child"?`${l.userName}`:""},{title:o(()=>[V(a(ue,{name:l.id,"icon-size":"16px",onClick:e[2]||(e[2]=H(()=>{},["stop"]))},null,8,["name"]),[[B,m.value]]),n("span",{onClick:H(c=>P(l),["stop"])},u(l.company),9,ze)]),default:o(()=>[n("ul",Ne,[n("li",null,"合作类型："+u(R.value.cooperationType[l.type]),1),n("li",null,"所属区域："+u(ge(De)(l.area)),1),n("li",null,"行业分类："+u(R.value.industryType[l.industry]),1),n("li",null,"来源："+u(R.value.source[l.source]),1),n("li",null,"最近联系："+u(C(l.lastTime)),1),n("li",null,"下次联系："+u(C(l.nextTime)),1),n("li",null,"创建时间："+u(C(l.creatTime)),1),n("li",null,"更新时间："+u(C(l.updateTime)),1)])]),_:2},1032,["name","value"])]),_:2},1024)]),default:o(()=>[a(me,{ref_key:"formRef",ref:M,data:oe.value,"submit-url":g.value?"customerSave":"customerEdit","request-url":"customerDetail",before:se,after:ne,"hide-filed":G.value,disabled:r.value==="shareWithMe",onCancel:D},{files:o(({rows:l,value:c})=>[a(Be,{disabled:r.value==="shareWithMe",item:l,"model-value":c,"onUpdate:modelValue":ae},null,8,["disabled","item","model-value"])]),_:1},8,["data","submit-url","hide-filed","disabled"])]),_:1},8,["search-form-data","form-title"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),V(a(be,{placeholder:!0},{default:o(()=>[n("div",Me,[a(p,{size:"small",type:"primary",disabled:!d.value.length,onClick:e[5]||(e[5]=l=>L("toUser"))},{default:o(()=>[...e[14]||(e[14]=[f(" 移交 ",-1)])]),_:1},8,["disabled"]),a(p,{size:"small",type:"warning",disabled:!d.value.length,onClick:e[6]||(e[6]=l=>$("toCom"))},{default:o(()=>[...e[15]||(e[15]=[f(" 转入公海 ",-1)])]),_:1},8,["disabled"]),r.value==="default"?(h(),S(p,{key:0,size:"small",type:"success",disabled:!d.value.length,onClick:e[7]||(e[7]=l=>L("myShare"))},{default:o(()=>[...e[16]||(e[16]=[f(" 共享客户 ",-1)])]),_:1},8,["disabled"])):F("",!0),r.value==="myShare"?(h(),S(p,{key:1,size:"small",type:"success",disabled:!d.value.length,onClick:e[8]||(e[8]=l=>$("cancelShare"))},{default:o(()=>[...e[17]||(e[17]=[f(" 取消共享 ",-1)])]),_:1},8,["disabled"])):F("",!0),a(p,{size:"small",type:"danger",disabled:!d.value.length,onClick:e[9]||(e[9]=l=>$("toInvalid"))},{default:o(()=>[...e[18]||(e[18]=[f(" 设为无效客户 ",-1)])]),_:1},8,["disabled"])]),a(p,{size:"small",type:"danger",color:"linear-gradient(to right, #ff6034, #ee0a24)",onClick:e[10]||(e[10]=l=>m.value=!1)},{default:o(()=>[...e[19]||(e[19]=[f(" 取消 ",-1)])]),_:1})]),_:1},512),[[B,m.value]]),a(Ve,{ref_key:"userDialogRef",ref:W,modelValue:q.value,"onUpdate:modelValue":e[11]||(e[11]=l=>q.value=l),"show-field":!1,data:{label:"用户"},multiple:E.value,onSelectClick:A},null,8,["modelValue","multiple"]),a(Fe,{ref_key:"recordsRef",ref:J},null,512),a(ye,{show:x.value,"onUpdate:show":e[12]||(e[12]=l=>x.value=l),"destroy-on-close":"",position:"right",teleport:"body",style:{width:"88%",height:"100%"},closeable:"","before-close":O},{default:o(()=>[a(Ue,{ref_key:"shareRef",ref:K,"user-ids":y.value.ids,"customer-id":y.value.customer,onChange:O},null,8,["user-ids","customer-id"])]),_:1},8,["show"])],64)}}}),Ze=Te(qe,[["__scopeId","data-v-493287fe"]]);export{Ze as default};
