import{_}from"./index.vue_vue_type_script_setup_true_lang-D4r7__Vy.js";import{_ as g}from"./index.vue_vue_type_script_setup_true_lang-BrL685TD.js";import{v as u}from"./validate-BQpdx7O0.js";import{d as G,k as J,M as W,l as a,s as l,C as z,I as c,c as A,h,g as x,q as i,r as b,o as K,i as V,t as F,J as Q}from"./index-BRtqQkpX.js";const X={style:{padding:"0 20px","margin-bottom":"8px"}},Z={style:{padding:"0 20px"}},ae=G({__name:"index",props:{company:{},keyColumns:{}},setup(T,{expose:D}){const M=T,I=J(),o=W("detailTabsProps",a({})),N=[{key:"add",click:()=>{S()},display:()=>!o.value.disabled}],k=a(),d=a(!1),y=a("新增联系人"),C=a(),n=a({});l(()=>z("userInfo",!0)||{});const Y=l(()=>o.value.customerId||n.value.customerId),L=(e,t)=>(e==="get"&&o.value.isComponents&&(t.customerId=o.value.customerId,t.userId=o.value.userId,o.value.tabsName==="shareWithMe"&&(t.specialCustomer=o.value.customerId,t.extend.search="comInvalidShare")),t),S=(e,t)=>{d.value=!0,y.value=`新增${M.company||""}跟进`},m=l(()=>!o.value.isComponents),q=l(()=>o.value.isComponents?o.value.tabsName==="child":I.userInfo?.hasChild),p=a({}),f=l(()=>o.value.userId||p.value?.userId),B=l(()=>o.value.isComponents?o.value.customerId:p.value.customerId),E=a([{type:"expand",prop:"expand",search:!1,width:30},{prop:"checked",type:"selection"},{label:"所属人员",prop:"userId",visible:!1,search:{changeRefresh:!0,style:{width:"230px"},visible:q,render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0}},{label:"客户名称",prop:"customerId",search:{userId:f,visible:m,render:"component",component:c(_)},formatter:e=>e.company,visible:m,showOverflowTooltip:!0},{label:"联系人",prop:"contactId",width:90,search:{userId:f,customerId:B,placeholder:"请输入联系人,可使用%",render:"component",component:c(g)},formatter:e=>e.contactName},{label:"跟进方式",prop:"type",render:"tag",width:110,replaceValue:"followType",search:{render:"select",options:"followType"}},{prop:"dateTime",label:"创建时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"userName",label:"跟进人",search:!1,width:90},{prop:"remark",label:"跟进内容",search:!1,formatter:e=>e.remark.length>20?e.remark?.substring(0,20)+"...":e.remark},{visible:()=>!o.value.disabled,width:90,prop:"operate",label:"操作",render:"buttons",search:!1,buttons:[{key:"del",label:"删除",icon:"",attr:{text:!0}}]}]),v=()=>{d.value=!1,n.value={},C.value.resetFields()},H=(e,t)=>(t==="add"&&o.value.isComponents&&(e.customerId=o.value.customerId),e),R=(e,t,r)=>(["add","update"].includes(r)&&(v(),w()),e),U=a([{label:"客户名称",prop:"customerId",attr:{},render:"component",component:c(_),visible:m,formItem:{rules:[u("required","客户名称不能为空","change")]}},{label:"联系人",prop:"contactId",attr:{placeholder:"请输入联系人,可使用%",customerId:Y,userId:f,onBlur:(e,t)=>{n.value.contactName=t}},render:"component",component:c(g),formItem:{rules:[u("required","联系人不能为空","change")]}},{label:"跟进方式",prop:"type",render:"select",options:"followType",formItem:{rules:[u("required","请选择跟进方式")]}},{label:"下次跟进时间",prop:"nextTime",render:"datePicker",attr:{type:"datetime",valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss"}},{label:"跟进内容",prop:"remark",attr:{style:{width:"100%"},type:"textarea",rows:3},formItem:{rules:[u("required","请输入跟进内容")]}}]),P=(e,t,r)=>{e==="customerId"&&t&&(r.contactId=void 0)},$=(e,t,r)=>{e==="userId"&&I.userInfo?.hasChild&&(r.customerId=null,r.contactId=void 0),e==="customerId"&&(r.contactId=void 0),p.value=r},w=()=>{k.value.getData()};return D({getData:w}),(e,t)=>{const r=b("ak-list"),j=b("ak-form"),O=b("el-dialog");return K(),A("div",null,[h(r,{ref_key:"tableListEl",ref:k,pk:"id",columns:E.value,api:{list:"followList",del:"followDel"},controlBtn:N,before:L,"auto-load":!i(o).isComponents,"show-search":!i(o).disabled,columnsIconVisible:!i(o).disabled,keyColumns:e.keyColumns,onFormFieldChange:$},{expand:x(({row:s})=>[V("div",X,"跟进时间："+F(i(Q)(s.dateTime)),1),V("div",Z,"跟进内容："+F(s.remark),1)]),_:1},8,["columns","auto-load","show-search","columnsIconVisible","keyColumns"]),h(O,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=s=>d.value=s),width:"800",title:y.value,class:"form-dialog","before-close":v},{default:x(()=>[h(j,{pk:"id",ref_key:"formRef",ref:C,data:U.value,"label-width":"100",class:"flex-form flex-form-2",api:{detail:"followGet",add:"followSave"},onCancel:v,after:R,before:H,onChange:P,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s)},null,8,["data","modelValue"])]),_:1},8,["modelValue","title"])])}}});export{ae as _};
