import{_ as I}from"./index.vue_vue_type_style_index_0_lang-yBlQ4h0k.js";import{d as L,v as r,G as E,c as C,h as b,g as q,F as N,B as V,r as f,o as F,E as D,H as S,z}from"./index-BqO2u9IT.js";import{v as h}from"./validate-DWZH7t8y.js";const M=L({__name:"user",setup(B){const v=(e,l)=>{V("deptList",{tid:e.data.id||0}).then(a=>{const s=a.data?.list||[];s.forEach(i=>{i.hasChildren=!i.hasChildren}),l(s)})},g=r(),w=r([{type:"selection"},{label:"序号",type:"index",width:80},{prop:"userName",label:"用户名称"},{prop:"phone",label:"手机"},{prop:"weixin",label:"微信"},{prop:"sex",label:"性别",render:"tag",replaceValue:"sex",custom:{1:"success",0:"danger"},search:{render:"select",options:"sex",clearable:!0}},{prop:"status",label:"状态",render:"tag",replaceValue:"status",custom:{1:"success",0:"danger"},search:{render:"select",options:"status",clearable:!0}},{prop:"departmentId",label:"所属部门",formatter:e=>e.departmentName,search:{clearable:!0,style:{width:"260px"},render:"tree-select",placeholder:"请选择所属部门",load:v,lazy:!0,checkStrictly:!0,props:{children:"children",label:"name",value:"id",isLeaf:"hasChildren"}}},{prop:"roleId",label:"角色权限",search:{render:"select",ajax:{api:"roleList",data:{},label:"name",value:"id"},clearable:!0},visible:!1},{prop:"loginTimer",label:"登录次数",search:!1},{prop:"lastLogin",label:"最后登录时间",width:120,showOverflowTooltip:!0,render:"datetime",search:!1},{prop:"ip",label:"登录ip",width:180,search:!1},{prop:"creatTime",label:"创建时间",width:120,showOverflowTooltip:!0,render:"datetime",search:!1},{prop:"updateTime",label:"更新时间",width:120,showOverflowTooltip:!0,render:"datetime",search:!1},{fixed:"right",label:"操作",render:"buttons",width:150,buttons:[{key:"edit",label:"查看",attr:{text:!0},click:e=>{k(!0,e)}},{label:"删除",key:"del",attr:{text:!0},popConfirm:{confirmButtonType:"danger"},disabled:e=>e.id===1}]}]),x=r([]),d=r("新增用户"),t=r(!0),o=r(!1),n=r(),p=r({}),k=(e,l)=>{o.value=!0,t.value=e,p.value={status:1,sex:1},e?(d.value="查看/编辑用户："+l.userName,z(()=>{n.value.getData({id:l.id})}),x.value=[{id:l?.departmentId,name:l?.departmentName}]):d.value="新增用户"},u=e=>e&&S(e),c=()=>{o.value=!1,n.value.resetFields()},T=(e,l)=>(l!=="detail"&&e.roleId&&(e.roleId=e.roleId.join(",")),l==="add"&&e.password===""?(D.error("密码不能为空"),!1):e),_=(e,l,a)=>{if(a==="detail"){if(l)return e.creatTime=u(e?.creatTime),e.updateTime=u(e?.updateTime),e.lastLogin=u(e?.lastLogin),e.roleId&&(e.roleId=e.roleId.split(",").map(Number)),e}else c(),g.value.getData()},y=r([{prop:"userName",label:"用户名称",formItem:{rules:[{required:!0,message:"请输入用户名称",trigger:"blur"}]},attr:{disabled:t}},{prop:"password",label:"登录密码",attr:{type:"password"}},{prop:"status",label:"状态",render:"radio",options:"status",attr:{}},{prop:"sex",label:"性别",render:"radio",options:"sex",attr:{}},{prop:"phone",label:"手机号码",formItem:{rules:[h("mobile"),h("required","请输入手机号码")]}},{prop:"weixin",label:"微信号码"},{prop:"qq",label:"qq号码"},{prop:"roleId",label:"角色权限",render:"select",ajax:{api:"roleList",data:{},label:"name",value:"id"},attr:{multiple:!0,collapseTags:!0,collapseTagsTooltip:!0},formItem:{rules:[h("required","请选择角色权限")]}},{prop:"departmentId",label:"所属部门",render:"tree-select",attr:{clearable:!0,data:x,placeholder:"请选择上级部门",load:v,lazy:!0,checkStrictly:!0,props:{children:"children",label:"name",value:"id",isLeaf:"hasChildren"}},formItem:{rules:[{required:!0,message:"请选择所属部门",trigger:"blur"}]}},{prop:"tid",label:"直属上级",render:"component",component:E(I),attr:{}},{prop:"departmentName",label:"所属部门",render:"text",visible:t},{prop:"tidName",label:"直属上级",render:"text",visible:t},{prop:"creatTime",label:"创建时间",attr:{disabled:!0},visible:t},{prop:"updateTime",label:"更新时间",attr:{disabled:!0},visible:t},{prop:"lastLogin",label:"最后登录时间",attr:{disabled:!0},visible:t},{prop:"loginTimer",label:"登录次数",attr:{disabled:!0},visible:t},{prop:"ip",label:"最后登录ip",attr:{disabled:!0},visible:t},{prop:"remark",label:"备注",attr:{style:{width:"100%"},rows:5,type:"textarea"}}]);return(e,l)=>{const a=f("ak-list"),s=f("ak-form"),i=f("el-dialog");return F(),C(N,null,[b(a,{ref_key:"tableListEl",ref:g,pk:"id",columns:w.value,api:{list:"userList",del:"userDelete"},"control-btn":[{key:"add",click:()=>{k(!1)}},{key:"del"}]},null,8,["columns","control-btn"]),b(i,{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=m=>o.value=m),width:"800",title:d.value,class:"form-dialog","before-close":c},{default:q(()=>[b(s,{ref_key:"formEl",ref:n,modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=m=>p.value=m),class:"flex-form flex-form-2",pk:"id","label-width":"120",after:_,before:T,data:y.value,api:{add:"userSave",edit:"userEdit",detail:"userGet"},onCancel:c},null,8,["modelValue","data"])]),_:1},8,["modelValue","title"])],64)}}});export{M as default};
