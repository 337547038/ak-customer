import{d as C,k as I,l,n as R,c as N,i as u,h as a,g as m,D as p,j as S,u as B,r as c,H as A,z as D,G,o as M,v as P,_ as T,P as x}from"./index-BRtqQkpX.js";import{W as U}from"./index-yAhGm0ul.js";const W={class:"container"},j={class:"form"},z=["src"],E={class:"weixin",style:{padding:"10px 0"}},h=C({__name:"index",setup(H){const f=B(),r=S(),y=I(),_=l(),b=()=>{_.value.open()},g=(t,e)=>{e?(A("resources",!0),y.setLoginInfo(t,!0),k(t.roleId).then(()=>{const o=r.query.redirect?r.query.redirect:"/";D(()=>{f.push({path:o})})})):n()},k=t=>new Promise(e=>{if(!t)return e();p("roleGetByIds",{id:t}).then(o=>{const d=o.data;G("resources",d,0),e()})}),s=l({userName:"admin",password:"12345"}),w=l([{prop:"userName",label:"用户名",formItem:{rules:[{required:!0,message:"请输入用户名",trigger:"blur"}]},attr:{}},{prop:"password",label:"密码",formItem:{rules:[{required:!0,message:"请输入密码",trigger:"blur"}]},attr:{type:"password"}}]),v=l(),n=()=>{p("getCaptcha",{}).then(t=>{const{base64:e,codeId:o}=t.data;v.value="data:image/png;base64,"+e,s.value.codeId=o}).catch(()=>{})},L=()=>{const t=r.query.code,e=r.query.state;t&&e&&p("scanLogin",{code:t}).then(o=>{g(o.data,!0)}).catch(()=>{f.push({path:"/login",query:{redirect:"/system/usercenter"}}),n()})};return R(()=>{n(),L()}),(t,e)=>{const o=c("el-input"),d=c("el-form-item"),V=c("ak-form"),q=c("el-button");return M(),N("div",W,[u("div",j,[e[3]||(e[3]=u("h3",null,"AK客户管理系统",-1)),a(V,{"label-width":"100",data:w.value,api:{add:"userLogin"},after:g,modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=i=>s.value=i)},{default:m(()=>[a(d,{label:"验证码",class:"item-code"},{default:m(()=>[a(o,{modelValue:s.value.code,"onUpdate:modelValue":e[0]||(e[0]=i=>s.value.code=i),placeholder:"输入验证码"},null,8,["modelValue"]),u("img",{src:v.value,class:"img",alt:"",onClick:n},null,8,z)]),_:1})]),_:1},8,["data","modelValue"]),u("div",E,[a(q,{type:"primary",text:"",onClick:b},{default:m(()=>e[2]||(e[2]=[P("微信扫码登录")])),_:1,__:[2]})]),a(U,{ref_key:"wxLoginRef",ref:_},null,512)])])}}});typeof x=="function"&&x(h);const J=T(h,[["__scopeId","data-v-f83907d0"]]);export{J as default};
