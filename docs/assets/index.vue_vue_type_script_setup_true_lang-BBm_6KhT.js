import{_ as D}from"./index.vue_vue_type_script_setup_true_lang-BGeArx4B.js";import{v as o}from"./validate-BPUuIrlQ.js";import{d as N,a7 as O,E as t,k as R,q as M,Q as Y,c as S,e as U,n as s,P as $,h as b,g as j,J as W,r as v,o as _}from"./index-CNiyTwfQ.js";import G from"./wap-Ds3eP_zq.js";const X=N({__name:"index",props:{company:{default:""},keyColumns:{default:""}},setup(h,{expose:g}){const T=h,l=O("detailTabsProps",t({})),V=R(),q=[{key:"add",click:()=>{x(!0)},display:()=>!l.value.disabled}],k=t(),r=t(!1),i=t("新增联系人"),w=t(),n=t({decisionMaker:1,sex:1}),d=t(!1),E=(e,a)=>(e==="get"&&l.value.isComponents&&(a.tid=l.value.customerId,a.userId=l.value.userId,l.value.tabsName==="shareWithMe"&&(a.specialCustomer=l.value.customerId,a.extend.search="comInvalidShare")),a),x=(e,a)=>{r.value=!0,d.value=!e,e?i.value=`新增${T.company||""}联系人`:(i.value=`编辑${a?.name}信息`,W(()=>{w.value.getData({id:a.id})}))},p=M(()=>!l.value.isComponents),H=M(()=>l.value.isComponents?l.value.tabsName==="child":V.userInfo?.hasChild),c=t(),y={1:"是",2:"否",3:"未知"},L=t([{prop:"checked",type:"selection"},{label:"所属人员",prop:"userId",visible:!1,search:{changeRefresh:!0,style:{width:"230px"},visible:H,render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0,onChange:e=>{c.value=e}}},{label:"客户名称",prop:"tid",search:{userId:c,visible:p,render:"component",component:Y(D)},formatter:e=>e.company,visible:p,width:160,showOverflowTooltip:!0},{label:"联系人",prop:"name",width:80},{label:"是否决策人",prop:"decisionMaker",render:"tag",replaceValue:y,custom:{1:"success",2:"primary",3:"warning"},search:!1,width:95},{label:"手机",prop:"phone"},{label:"性别",prop:"sex",render:"tag",replaceValue:"sex",search:!1,width:60},{label:"微信",prop:"weixin"},{label:"电话",prop:"tel",search:!1},{label:"QQ",prop:"qq",search:!1},{label:"电子邮件",prop:"email",search:!1},{label:"职位",prop:"position",search:!1},{prop:"creatDate",label:"创建时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"lastTime",label:"最后联系时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"nextTime",label:"下次联系时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{visible:()=>!l.value.disabled,fixed:"right",prop:"operate",label:"操作",render:"buttons",width:"120px",search:!1,buttons:[{key:"edit",label:"编辑",attr:{text:!0},click:e=>{x(!1,e)}},{key:"del",label:"删除",icon:"",attr:{text:!0}}]}]),u=()=>{r.value=!1,n.value={decisionMaker:1,sex:1}},P=(e,a)=>(a==="add"&&l.value.isComponents&&(e.tid=l.value.customerId),e),Q=(e,a,m)=>(["add","update"].includes(m)&&(u(),I()),e),C=t([{label:"客户名称",prop:"tid",attr:{style:{width:"350px"},userId:c},render:"component",component:Y(D),visible:p,formItem:{rules:[o("required","客户名称不能为空")]}},{label:"姓名",prop:"name",formItem:{rules:[o("required","姓名不能为空")]}},{label:"手机",prop:"phone",formItem:{rules:[o("mobile"),o("required","请输入手机号")]}},{label:"职务",prop:"position"},{label:"电话",prop:"tel",formItem:{rules:[o("tel")]}},{label:"微信号",prop:"weixin"},{label:"QQ",prop:"qq"},{label:"电子邮件",prop:"email",formItem:{rules:[o("email")]}},{label:"是否决策人",prop:"decisionMaker",render:"radio",options:y},{label:"性别",prop:"sex",render:"radio",options:"sex"},{label:"生日",prop:"birthday",render:"datePicker",attr:{valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD"}},{label:"地址",prop:"address"},{label:"最后联系时间",prop:"lastTime",attr:{disabled:!0},visible:d},{label:"下次跟进时间",prop:"nextTime",render:"datePicker",attr:{type:"datetime",valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss"}},{label:"创建时间",prop:"creatDate",attr:{disabled:!0},visible:d},{label:"备注",prop:"remark",attr:{style:{width:"100%"},type:"textarea",rows:3}}]),I=()=>{k.value.getData()};return g({getData:I}),(e,a)=>{const m=v("ak-list"),B=v("ak-form"),F=v("el-dialog");return s($)()?(_(),U(G,{key:1,"form-data":C.value},null,8,["form-data"])):(_(),S("div",{key:0,ref_key:"tableListEl",ref:k},[b(m,{pk:"id",columns:L.value,api:{list:"contactList",del:"contactDel"},"control-btn":q,before:E,"show-search":!s(l).disabled,"columns-icon-visible":!s(l).disabled,"auto-load":!s(l).isComponents,"key-columns":h.keyColumns},null,8,["columns","show-search","columns-icon-visible","auto-load","key-columns"]),b(F,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=f=>r.value=f),width:"800",title:i.value,class:"form-dialog","before-close":u},{default:j(()=>[b(B,{ref_key:"formRef",ref:w,modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=f=>n.value=f),pk:"id",data:C.value,"label-width":"100",class:"flex-form flex-form-2",api:{detail:"contactGet",add:"contactSave",edit:"contactEdit"},after:Q,before:P,onCancel:u},null,8,["modelValue","data"])]),_:1},8,["modelValue","title"])],512))}}});export{X as _};
