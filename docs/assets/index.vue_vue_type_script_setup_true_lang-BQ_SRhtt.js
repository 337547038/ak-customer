import{_}from"./index.vue_vue_type_script_setup_true_lang-lWq4qB80.js";import{_ as g}from"./index.vue_vue_type_script_setup_true_lang-CEYRMk56.js";import{v as u}from"./validate-BQpdx7O0.js";import{d as G,k as z,N as A,l as a,s as l,C as J,I as c,c as K,h as v,g as x,q as i,r as I,o as Q,i as V,t as F,L as W}from"./index-D_PG1Bnj.js";const X={style:{padding:"0 20px","margin-bottom":"8px"}},Z={style:{padding:"0 20px"}},ae=G({__name:"index",props:{company:{},keyColumns:{}},setup(T,{expose:D}){const N=T,b=z(),t=A("detailTabsProps",a({})),Y=[{key:"add",click:()=>{q()},display:()=>!t.value.disabled}],k=a(),d=a(!1),w=a("新增联系人"),y=a(),n=a({});l(()=>J("userInfo",!0)||{});const L=l(()=>t.value.customerId||n.value.customerId),M=(e,o)=>(e==="get"&&t.value.isComponents&&(o.customerId=t.value.customerId,o.userId=t.value.userId),o),q=(e,o)=>{d.value=!0,w.value=`新增${N.company||""}跟进`},m=l(()=>!t.value.isComponents),B=l(()=>t.value.isComponents?t.value.tabsName==="child":b.userInfo?.hasChild),p=a({}),f=l(()=>t.value.userId||p.value?.userId),E=l(()=>t.value.isComponents?t.value.customerId:p.value.customerId),S=a([{type:"expand",prop:"expand",search:!1,width:30},{prop:"checked",type:"selection"},{label:"所属人员",prop:"userId",show:!1,search:{changeRefresh:!0,style:{width:"230px"},visible:B,render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0}},{label:"客户名称",prop:"customerId",search:{userId:f,visible:m,render:"component",component:c(_)},formatter:e=>e.company,show:m,showOverflowTooltip:!0},{label:"联系人",prop:"contactId",width:90,search:{userId:f,customerId:E,placeholder:"请输入联系人,可使用%",render:"component",component:c(g)},formatter:e=>e.contactName},{label:"跟进方式",prop:"type",render:"tag",width:110,replaceValue:"followType",search:{render:"select",options:"followType"}},{prop:"dateTime",label:"创建时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"userName",label:"跟进人",search:!1,width:90},{prop:"remark",label:"跟进内容",search:!1,formatter:e=>e.remark.length>20?e.remark?.substring(0,20)+"...":e.remark},{show:!t.value.disabled,width:90,prop:"operate",label:"操作",render:"buttons",search:!1,buttons:[{key:"del",label:"删除",icon:"",attr:{text:!0}}]}]),h=()=>{d.value=!1,n.value={},y.value.resetFields()},H=(e,o)=>(o==="add"&&t.value.isComponents&&(e.customerId=t.value.customerId),e),R=(e,o,r)=>(["add","update"].includes(r)&&(h(),C()),e),U=a([{label:"客户名称",prop:"customerId",attr:{},render:"component",component:c(_),visible:m,formItem:{rules:[u("required","客户名称不能为空","change")]}},{label:"联系人",prop:"contactId",attr:{placeholder:"请输入联系人,可使用%",customerId:L,userId:f,onBlur:(e,o)=>{n.value.contactName=o}},render:"component",component:c(g),formItem:{rules:[u("required","联系人不能为空","change")]}},{label:"跟进方式",prop:"type",render:"select",options:"followType",formItem:{rules:[u("required","请选择跟进方式")]}},{label:"下次跟进时间",prop:"nextTime",render:"datePicker",attr:{type:"datetime",valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss"}},{label:"跟进内容",prop:"remark",attr:{style:{width:"100%"},type:"textarea",rows:3},formItem:{rules:[u("required","请输入跟进内容")]}}]),P=(e,o,r)=>{e==="customerId"&&o&&(r.contactId=void 0)},$=(e,o,r)=>{e==="userId"&&b.userInfo?.hasChild&&(r.customerId=null,r.contactId=void 0),e==="customerId"&&(r.contactId=void 0),p.value=r},C=()=>{k.value.getData()};return D({getData:C}),(e,o)=>{const r=I("ak-list"),j=I("ak-form"),O=I("el-dialog");return Q(),K("div",null,[v(r,{ref_key:"tableListEl",ref:k,pk:"id",columns:S.value,api:{list:"followList",del:"followDel"},controlBtn:Y,before:M,"auto-load":!i(t).isComponents,"show-search":!i(t).disabled,columnsIconVisible:!i(t).disabled,keyColumns:e.keyColumns,onFormFieldChange:$},{expand:x(({row:s})=>[V("div",X,"跟进时间："+F(i(W)(s.dateTime)),1),V("div",Z,"跟进内容："+F(s.remark),1)]),_:1},8,["columns","auto-load","show-search","columnsIconVisible","keyColumns"]),v(O,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=s=>d.value=s),width:"800",title:w.value,class:"form-dialog","before-close":h},{default:x(()=>[v(j,{pk:"id",ref_key:"formRef",ref:y,data:U.value,"label-width":"100",class:"flex-form flex-form-2",api:{detail:"followGet",add:"followSave"},onCancel:h,after:R,before:H,onChange:P,modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=s=>n.value=s)},null,8,["data","modelValue"])]),_:1},8,["modelValue","title"])])}}});export{ae as _};
