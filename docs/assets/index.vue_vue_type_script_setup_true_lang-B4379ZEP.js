import{_ as g}from"./index.vue_vue_type_script_setup_true_lang-_AmnQ_dk.js";import{_}from"./selectContact.vue_vue_type_script_setup_true_lang-m3T1-wYp.js";import{v as c}from"./validate-BQpdx7O0.js";import{d as G,k as P,l as r,s as l,I as m,c as z,h as p,g as x,r as f,o as A,i as V,t as D,q as J,C as K,L as Q}from"./index-CJ8aW7xe.js";const W={style:{padding:"0 20px","margin-bottom":"8px"}},X={style:{padding:"0 20px"}},re=G({__name:"index",props:{isComponents:{type:Boolean,default:!1},customerId:{},company:{},disabled:{type:Boolean},keyColumns:{}},setup(F,{expose:T}){const t=F,h=P(),Y=[{key:"add",click:()=>{N()},display:()=>!t.disabled}],b=r(),n=r(!1),v=r("新增联系人"),B=r(),d=r({});l(()=>K("userInfo",!0)||{});const I=r(),y=l(()=>I.value||t.customerId),L=(e,o)=>(e==="get"&&t.isComponents&&(o.customerId=y.value),o),N=(e,o)=>{n.value=!0,v.value=`新增${t.company||""}跟进`},i=l(()=>!t.isComponents),q=l(()=>t.isComponents?t.tabsName==="child":h.userInfo?.hasChild),k=r(),E=l(()=>t.isComponents?t.customerId:k.value),C=r(),M=r([{type:"expand",prop:"expand",search:!1},{prop:"checked",type:"selection"},{label:"所属人员",prop:"userId",show:!1,search:{changeRefresh:!0,style:{width:"230px"},visible:q,render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0,onChange:e=>{C.value=e}}},{label:"客户名称",prop:"customerId",search:{userId:C,visible:i,render:"component",component:m(g)},formatter:e=>e.company,show:i,showOverflowTooltip:!0},{label:"联系人",prop:"contactId",width:90,search:{customerId:E,placeholder:"请输入联系人,可使用%",render:"component",component:m(_)},formatter:e=>e.contactName},{label:"跟进方式",prop:"type",render:"tag",width:110,replaceValue:"followType",search:{render:"select",options:"followType"}},{prop:"dateTime",label:"创建时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"userName",label:"跟进人",search:!1,width:90},{prop:"remark",label:"跟进内容",search:!1,formatter:e=>e.remark.length>20?e.remark?.substring(0,20)+"...":e.remark},{show:!t.disabled,width:90,prop:"operate",label:"操作",render:"buttons",search:!1,buttons:[{key:"del",label:"删除",icon:"",attr:{text:!0}}]}]),u=()=>{n.value=!1,d.value={}},S=(e,o)=>(o==="add"&&t.isComponents&&(e.customerId=t.customerId),e),H=(e,o,a)=>(["add","update"].includes(a)&&(u(),w()),e),R=r([{label:"客户名称",prop:"customerId",attr:{},render:"component",component:m(g),visible:i,formItem:{rules:[c("required","客户名称不能为空","change")]}},{label:"联系人",prop:"contactId",attr:{placeholder:"请输入联系人,可使用%",customerId:y,onBlur:(e,o)=>{d.value.contactName=o}},render:"component",component:m(_),formItem:{rules:[c("required","联系人不能为空","change")]}},{label:"跟进方式",prop:"type",render:"select",options:"followType",formItem:{rules:[c("required","请选择跟进方式")]}},{label:"下次跟进时间",prop:"nextTime",render:"datePicker",attr:{type:"datetime",valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss"}},{label:"跟进内容",prop:"remark",attr:{style:{width:"100%"},type:"textarea",rows:3},formItem:{rules:[c("required","请输入跟进内容")]}}]),U=(e,o,a)=>{e==="customerId"&&o&&(a.contactId=void 0,I.value=o)},$=(e,o,a)=>{e==="userId"&&h.userInfo?.hasChild&&(a.customerId=null,a.contactId=void 0),e==="customerId"&&(a.contactId=void 0,k.value=o)},w=()=>{b.value.getData()};return T({getData:w}),(e,o)=>{const a=f("ak-list"),O=f("ak-form"),j=f("el-dialog");return A(),z("div",null,[p(a,{ref_key:"tableListEl",ref:b,pk:"id",columns:M.value,api:{list:"followList",del:"followDel"},controlBtn:Y,before:L,"auto-load":!e.isComponents,"show-search":!e.disabled,columnsIconVisible:!e.disabled,keyColumns:e.keyColumns,onFormFieldChange:$},{expand:x(({row:s})=>[V("div",W,"跟进时间："+D(J(Q)(s.dateTime)),1),V("div",X,"跟进内容："+D(s.remark),1)]),_:1},8,["columns","auto-load","show-search","columnsIconVisible","keyColumns"]),p(j,{modelValue:n.value,"onUpdate:modelValue":o[1]||(o[1]=s=>n.value=s),width:"800",title:v.value,class:"form-dialog","before-close":u},{default:x(()=>[p(O,{pk:"id",ref_key:"formRef",ref:B,data:R.value,"label-width":"100",class:"flex-form flex-form-2",api:{detail:"followGet",add:"followSave"},onCancel:u,after:H,before:S,onChange:U,modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=s=>d.value=s)},null,8,["data","modelValue"])]),_:1},8,["modelValue","title"])])}}});export{re as _};
