import{d as N,l as s,e as I,o as C,g as u,w as U,a as M,r as p,h as a,v as V,i as $,D as L,E as T,I as j,k as q,s as B,c as W,F as z,f as A}from"./index-BRtqQkpX.js";import{_ as G}from"./formData-C6o8LEO1.js";import{g as H}from"./getCityByCode-DzjNnDGo.js";import{_ as J}from"./detailTabs.vue_vue_type_script_setup_true_lang-Dd0YgGSy.js";import{_ as K}from"./index.vue_vue_type_style_index_0_lang-5PPIJRQk.js";import"./validate-BQpdx7O0.js";import"./areas-c4JLuV3N.js";import"./index.vue_vue_type_script_setup_true_lang-Bb8SN_iQ.js";import"./index.vue_vue_type_script_setup_true_lang-D4r7__Vy.js";import"./index.vue_vue_type_script_setup_true_lang-C2LmDYZU.js";import"./index.vue_vue_type_script_setup_true_lang-BrL685TD.js";import"./paymentForm.vue_vue_type_script_setup_true_lang-C-ydie5E.js";import"./index.vue_vue_type_script_setup_true_lang-DK9fkLjQ.js";const P=N({__name:"import",setup(y,{expose:k}){const i=s(!1),c=s(!1),o=s(),m=s(),w=s([]),S=l=>{const t=new FormData;t.append("file",l.file),i.value=!0,L("customerImport",t).then(()=>{i.value=!1,m.value&&m.value(),f(),T.success("导入成功")}).catch(()=>{i.value=!1,T.error("导入失败")})},f=()=>{o.value.clearFiles(),c.value=!1,m.value=""},_=()=>{o.value.submit()};return k({openDialog:l=>{c.value=!0,m.value=l}}),(l,t)=>{const b=p("el-button"),v=p("el-upload"),h=p("el-form-item"),D=p("el-form"),g=p("el-dialog"),R=M("loading");return C(),I(g,{width:"500",modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),title:"导入客户","before-close":f},{default:u(()=>[U((C(),I(D,null,{default:u(()=>[a(h,{label:"请选择xlsx文件"},{default:u(()=>[a(v,{accept:".xlsx","auto-upload":!1,ref_key:"uploadRef",ref:o,"file-list":w.value,"onUpdate:fileList":t[0]||(t[0]=e=>w.value=e),"http-request":S},{trigger:u(()=>[a(b,{type:"primary"},{default:u(()=>t[2]||(t[2]=[V("选择文件")])),_:1,__:[2]})]),_:1},8,["file-list"])]),_:1}),a(h,{class:"form-item-flex"},{default:u(()=>[a(b,{type:"primary",onClick:_},{default:u(()=>t[3]||(t[3]=[V("确定")])),_:1,__:[3]}),a(b,{onClick:f},{default:u(()=>t[4]||(t[4]=[V("取消")])),_:1,__:[4]})]),_:1}),a(h,{class:"form-item-flex"},{default:u(()=>t[5]||(t[5]=[$("a",{href:"/template.xlsx"},"下载导入模板",-1)])),_:1,__:[5]})]),_:1})),[[R,i.value]])]),_:1},8,["modelValue"])}}}),Q={label:"所属人员",prop:"userId",width:100,search:{changeRefresh:!0,style:{width:"230px"},render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0},formatter:y=>y.userName},E=[{type:"selection",width:30},{label:"序号",type:"index",width:60},{prop:"company",label:"客户名称",width:240,showOverflowTooltip:!0},{prop:"type",label:"合作类型",width:150,render:"tag",replaceValue:"cooperationType",search:{render:"select",options:"cooperationType"}},{prop:"area",label:"所属区域",search:{render:"component",component:j(G)},formatter:(y,k,i)=>H(i),width:200,showOverflowTooltip:!0},{prop:"industry",label:"行业分类",width:150,render:"tag",replaceValue:"industryType",search:{render:"select",options:"industryType"}},{prop:"source",label:"来源",width:140,render:"tag",replaceValue:"source",search:{render:"select",options:"source"}},{prop:"lastTime",label:"最近联系时间",width:150,showOverflowTooltip:!0,render:"datetime",search:!1},{prop:"nextTime",label:"下次联系时间",render:"datetime",search:!1,width:150,showOverflowTooltip:!0},{prop:"creatTime",label:"创建时间",render:"datetime",search:!1,width:150,showOverflowTooltip:!0},{prop:"updateTime",label:"更新时间",width:150,showOverflowTooltip:!0,render:"datetime",search:!1},{prop:"operation",label:"操作",render:"buttons",search:!1,fixed:"right",buttons:[{key:"detail",label:"详情",icon:"",attr:{text:!0}}]}],ce=N({__name:"index",setup(y){const k=q(),i=s(),c=s(!1),o=s("default"),m=B(()=>k.userInfo?.hasChild),w=e=>{t()},S=B(()=>o.value==="child"?[...E.slice(0,3),Q,...E.slice(3)]:E),f=s(),_=s(),d=s([]),l=s(),t=()=>{_.value.getData()},b=B(()=>o.value==="shareWithMe"?[]:[{key:"add",click:()=>{g(!0)}},{key:"import",label:"导入",click:()=>{f.value.openDialog(t)},icon:"icon-import"},{key:"toUser",label:"移交",icon:"icon-toUser",click:e=>{c.value=!1,i.value.open(),d.value=e,l.value="toUser"},disabled:e=>!e?.length},{key:"toCom",label:"转入公海",icon:"icon-toCom",disabled:e=>!e?.length,click:e=>{d.value=e,l.value="toCom",v({})},render:"confirm",popConfirm:{title:"确认将所选客户转入公海吗？",width:300}},{key:"share",label:"共享客户",icon:"icon-share",disabled:e=>!e?.length,display:()=>o.value==="default",click:e=>{c.value=!0,d.value=e,l.value="myShare",i.value.open()}},{key:"cancelShare",label:"取消共享",icon:"icon-share",disabled:e=>!e?.length,display:()=>o.value==="myShare",click:e=>{d.value=e,l.value="cancelShare",v({})}},{key:"toInvalid",label:"设为无效客户",icon:"icon-invalid",render:"confirm",popConfirm:{title:"确认将所选客户设置为无效客户吗？",width:300},disabled:e=>!e?.length,click:e=>{d.value=e,l.value="toInvalid",v({})}}]),v=e=>{const r=d.value?.map(n=>n.id).join(",");if(l.value==="myShare"||l.value==="cancelShare"){let n="";l.value==="myShare"&&(n=e==="all"?"0":e?.map(x=>x.id).join(",")),L("customerShare",{ids:r,userId:n,type:l.value}).then(x=>{T.success("操作成功"),_.value.table?.clearSelection(),l.value==="cancelShare"&&t()})}else L("customerMove",{ids:r,userId:e.id,type:l.value}).then(n=>{T.success("操作成功"),t()}).catch(()=>{})},h=s(),D=(e,r)=>(e==="get"&&(r.extend.columns="contact",o.value!=="default"&&(r.extend.search=o.value)),r),g=(e,r)=>{h.value.openDrawer(e,r||{},t)},R=(e,r,n)=>{if(e==="row")switch(r.key){case"detail":g(!1,n);break}};return(e,r)=>{const n=p("el-tab-pane"),x=p("el-tabs"),F=p("ak-list");return C(),W(z,null,[a(x,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=O=>o.value=O),class:"demo-tabs",onTabChange:w},{default:u(()=>[a(n,{label:"我的客户",name:"default"}),m.value?(C(),I(n,{key:0,label:"下属客户",name:"child"})):A("",!0),a(n,{label:"共享客户",name:"shareWithMe"}),a(n,{label:"我共享的",name:"myShare"})]),_:1},8,["modelValue"]),a(F,{ref_key:"tableListEl",ref:_,pk:"id",columns:S.value,api:{list:"customerList",export:"customerExport"},controlBtn:b.value,before:D,onEventClick:R},null,8,["columns","controlBtn"]),a(J,{ref_key:"detailTableRef",ref:h,tabsType:o.value},null,8,["tabsType"]),a(P,{ref_key:"importDialogRef",ref:f},null,512),a(K,{ref_key:"userDialogRef",ref:i,showInput:!1,multiple:c.value,onSelectClick:v},null,8,["multiple"])],64)}}});export{ce as default};
