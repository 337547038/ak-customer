import{d as v,E as V,l as h,a4 as b,e as g,o as R,g as q,h as w,r as n,a7 as B,n as C,ab as k,R as x,a1 as L}from"./index-CkpV00AO.js";const E=v({__name:"upload",props:{item:{},modelValue:{default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:d}){const o=t,m=d,l=V([]),r=h(()=>o.modelValue,()=>{if(o.modelValue&&!l.value.length){const e=o.modelValue.split(",");l.value=[],e.forEach(a=>{l.value.push({url:a})})}},{immediate:!0}),u=()=>{const e=l.value.map(a=>a.url).join(",");m("update:modelValue",e)},i=()=>{u()},c=e=>{const a=new FormData;a.append("file",e.file),e.message="上传中...",e.status="uploading",x("upload",a).then(({data:s})=>{e.status="done",e.url=s,u()}).catch(()=>{e.message="上传失败",e.status="failed",L(`${e.file.name}上传失败`)})};return b(()=>{r()}),(e,a)=>{const s=n("van-uploader"),p=n("van-field");return R(),g(p,B(t.item.field,{name:t.item.prop,label:t.item.label,rules:t.item.rules,required:C(k)(t.item.rules)}),{input:q(()=>[w(s,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=f=>l.value=f),disabled:t.disabled,"after-read":c,onDelete:i},null,8,["modelValue","disabled"])]),_:1},16,["name","label","rules","required"])}}});export{E as _};
