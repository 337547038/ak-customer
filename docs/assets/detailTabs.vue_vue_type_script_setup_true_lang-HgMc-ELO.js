import{d as O,E as o,c as I,o as l,f as v,i as te,F as P,b as z,e as m,r as b,g as r,x as B,t as A,h as f,R as U,T as le,k as se,q as D,J as M,n as oe,S as N,a0 as ne}from"./index-DuawtOAE.js";import{_ as re}from"./index.vue_vue_type_script_setup_true_lang-BDE5ISvZ.js";import{f as q}from"./formData-sEcW0Gz7.js";import{_ as ue,a as de}from"./index.vue_vue_type_script_setup_true_lang-CZQfavAS.js";import{_ as ie}from"./index.vue_vue_type_script_setup_true_lang-BfXNU2mk.js";const ce={key:0},me={key:1},fe={key:2,style:{"padding-top":"15px"}},pe=O({__name:"shareInfo",props:{userIds:{},customerId:{},disabled:{type:Boolean}},emits:["update:userIds","change"],setup(p,{expose:S,emit:h}){const C=p,T=h,i=o([]),u=()=>{C.userIds&&U("userListByIds",{ids:C.userIds}).then(n=>{i.value=n.data})},V=(n,e)=>{i.value.splice(e,1);const d=i.value.map(y=>y.id).join(",");_(d,"share")},_=(n,e)=>{U("customerShare",{ids:C.customerId,userId:n,type:e}).then(()=>{le.success("操作成功"),T("update:userIds",n),n===""&&T("change")})};return S({getData:u}),(n,e)=>{const d=b("el-tag"),y=b("el-button");return l(),I("div",null,[p.userIds==="0"?(l(),I("div",ce," 当前客户已共享给所有人 ")):i.value?(l(),I("div",me,[e[1]||(e[1]=te("p",{style:{"padding-bottom":"15px"}}," 当前客户已共享给: ",-1)),(l(!0),I(P,null,z(i.value,(c,x)=>(l(),m(d,{key:c.id,closable:!p.disabled,style:{"margin-right":"5px"},onClose:F=>V(c,x)},{default:r(()=>[B(A(c.userName),1)]),_:2},1032,["closable","onClose"]))),128))])):v("",!0),p.disabled?v("",!0):(l(),I("div",fe,[f(y,{type:"danger",onClick:e[0]||(e[0]=c=>_("","cancelShare"))},{default:r(()=>[...e[2]||(e[2]=[B(" 取消分享 ",-1)])]),_:1})]))])}}}),ge=O({__name:"detailTabs",props:{disabled:{type:Boolean},tabsType:{default:""}},setup(p,{expose:S}){const h=p,C=se(),T=D(()=>C.userInfo?.id),i=D(()=>h.tabsType==="shareWithMe"),u=o({}),V=o(),_=o("detail"),n=o(!1),e=o({}),d=o(!0),y=o(),c=o(),x=()=>{n.value=!1,c.value&&c.value(),M(()=>{u.value={},_.value="detail",R.value=[],c.value=void 0})},F=(a,t,k)=>{n.value=!0,d.value=a,e.value=t,c.value=k,a?y.value="新增客户":(y.value=t.company+"详情",M(()=>{V.value.getData({id:t.id})}))},J=D(()=>({userId:e.value.userId,customerId:e.value.id,isComponents:!0,tabsName:h.tabsType,disabled:h.disabled||i.value}));ne("detailTabsProps",J);const $=o(),L=o(),j=o(),E=o(),W=a=>{switch(a){case"follow":j.value.getData();break;case"contact":$.value.getData();break;case"contract":L.value.getData();break;case"operate":Q();break;case"share":E.value.getData();break}},G=(a,t)=>(["add","update"].includes(t)&&a.area&&(a.area=a.area.join(",")),a),H=(a,t,k)=>(["add","update"].includes(k)?x():k==="detail"&&(a.lastTime=N(e.value.lastTime),a.nextTime=N(e.value.nextTime),a.area&&(a.area=a.area.split(","))),a),K=D(()=>d.value?q.filter(a=>a.visible!=="isDetailForm"):q),R=o([]),Q=()=>{e.value.id&&R.value.length===0&&U("customerRecords",{tid:e.value.id}).then(a=>{R.value=a.data.list||[]})},X=()=>{_.value="detail"};return S({openDrawer:F}),(a,t)=>{const k=b("ak-form"),g=b("el-tab-pane"),Y=b("el-timeline-item"),Z=b("el-timeline"),ee=b("el-tabs"),ae=b("el-drawer");return l(),m(ae,{modelValue:n.value,"onUpdate:modelValue":t[4]||(t[4]=s=>n.value=s),size:"88%",title:y.value,"before-close":x},{default:r(()=>[f(ee,{modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=s=>_.value=s),onTabChange:W},{default:r(()=>[f(g,{label:"客户详情",name:"detail"},{default:r(()=>[f(k,{ref_key:"formRef",ref:V,modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),pk:"id","label-width":"100",class:"flex-form flex-form-2",after:H,data:K.value,before:G,disabled:p.disabled||i.value,api:{detail:"customerDetail",add:"customerSave",edit:"customerEdit"},onCancel:x},{files:r(({rows:s})=>[n.value?(l(),m(ue,{key:0,modelValue:u.value.files,"onUpdate:modelValue":t[0]||(t[0]=w=>u.value.files=w),prop:s.prop,label:s.label},null,8,["modelValue","prop","label"])):v("",!0)]),_:1},8,["modelValue","data","disabled"])]),_:1}),d.value?v("",!0):(l(),m(g,{key:0,label:"跟进记录",name:"follow"},{default:r(()=>[f(ie,{ref_key:"followRef",ref:j,"key-columns":"customerFollow",company:e.value.company},null,8,["company"])]),_:1})),d.value?v("",!0):(l(),m(g,{key:1,label:"联系人",name:"contact"},{default:r(()=>[f(re,{ref_key:"contactRef",ref:$,"key-columns":"customerContact",company:e.value.company},null,8,["company"])]),_:1})),d.value?v("",!0):(l(),m(g,{key:2,label:"合同",name:"contract"},{default:r(()=>[f(de,{ref_key:"contractRef",ref:L,"key-columns":"customerContract"},null,512)]),_:1})),d.value?v("",!0):(l(),m(g,{key:3,label:"操作记录",name:"operate"},{default:r(()=>[f(Z,null,{default:r(()=>[(l(!0),I(P,null,z(R.value,(s,w)=>(l(),m(Y,{key:w,timestamp:s.userName+s.content},{default:r(()=>[B(A(oe(N)(s.dataTime)),1)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})),u.value?.userId===T.value&&u.value.shareUserId?(l(),m(g,{key:4,label:"分享详情",name:"share"},{default:r(()=>[f(pe,{ref_key:"shareInfoRef",ref:E,"user-ids":u.value.shareUserId,"onUpdate:userIds":t[2]||(t[2]=s=>u.value.shareUserId=s),disabled:p.disabled||i.value,"customer-id":e.value.id,onChange:X},null,8,["user-ids","disabled","customer-id"])]),_:1})):v("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}});export{ge as _};
