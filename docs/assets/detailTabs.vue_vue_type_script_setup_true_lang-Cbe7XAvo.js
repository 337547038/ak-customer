import{d as A,k as G,q as _,E as l,e as u,g as s,J as S,r as k,o as d,h as n,f,S as U,a2 as H}from"./index-CkpV00AO.js";import{_ as K}from"./index.vue_vue_type_script_setup_true_lang-D6ohUbd9.js";import{f as F}from"./formData-DT1JPN7P.js";import{_ as Q,a as X}from"./index.vue_vue_type_script_setup_true_lang-DO-Pn4Pm.js";import{_ as Y}from"./index.vue_vue_type_script_setup_true_lang-C1DakWOb.js";import{R as Z,S as ee}from"./records-jxO1YCSg.js";const ne=A({__name:"detailTabs",props:{disabled:{type:Boolean},tabsType:{default:""}},setup(y,{expose:N}){const C=y,B=G(),$=_(()=>B.userInfo?.id),I=_(()=>C.tabsType==="shareWithMe"),o=l({}),T=l(),p=l("detail"),v=l(!1),r=l({}),c=l(!0),R=l(),b=l(),V=()=>{v.value=!1,b.value&&b.value(),S(()=>{o.value={},p.value="detail",b.value=void 0})},j=(e,a,i)=>{v.value=!0,c.value=e,r.value=a,b.value=i,e?R.value="新增客户":(R.value=a.company+"详情",S(()=>{T.value.getData({id:a.id})}))},E=_(()=>({userId:r.value.userId,customerId:r.value.id,isComponents:!0,tabsName:C.tabsType,disabled:C.disabled||I.value}));H("detailTabsProps",E);const g=l(),h=l(),D=l(),w=l(),x=l(),M=e=>{switch(e){case"follow":w.value.getData();break;case"contact":h.value.getData();break;case"contract":D.value.getData();break;case"operate":g.value.getData();break;case"share":x.value.getData();break}},P=(e,a)=>(["add","update"].includes(a)&&e.area&&(e.area=e.area.join(",")),e),q=(e,a,i)=>(["add","update"].includes(i)?V():i==="detail"&&(e.lastTime=U(r.value.lastTime),e.nextTime=U(r.value.nextTime),e.area&&(e.area=e.area.split(","))),e),z=_(()=>c.value?F.filter(e=>e.visible!=="isDetailForm"):F),J=()=>{p.value="detail"};return N({openDrawer:j}),(e,a)=>{const i=k("ak-form"),m=k("el-tab-pane"),L=k("el-tabs"),O=k("el-drawer");return d(),u(O,{modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=t=>v.value=t),size:"88%",title:R.value,"before-close":V},{default:s(()=>[n(L,{modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=t=>p.value=t),onTabChange:M},{default:s(()=>[n(m,{label:"客户详情",name:"detail"},{default:s(()=>[n(i,{ref_key:"formRef",ref:T,modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=t=>o.value=t),pk:"id","label-width":"100",class:"flex-form flex-form-2",after:q,data:z.value,before:P,disabled:y.disabled||I.value,api:{detail:"customerDetail",add:"customerSave",edit:"customerEdit"},onCancel:V},{files:s(({rows:t})=>[v.value?(d(),u(Q,{key:0,modelValue:o.value.files,"onUpdate:modelValue":a[0]||(a[0]=W=>o.value.files=W),prop:t.prop,label:t.label},null,8,["modelValue","prop","label"])):f("",!0)]),_:1},8,["modelValue","data","disabled"])]),_:1}),c.value?f("",!0):(d(),u(m,{key:0,label:"跟进记录",name:"follow"},{default:s(()=>[n(Y,{ref_key:"followRef",ref:w,"key-columns":"customerFollow",company:r.value.company},null,8,["company"])]),_:1})),c.value?f("",!0):(d(),u(m,{key:1,label:"联系人",name:"contact"},{default:s(()=>[n(K,{ref_key:"contactRef",ref:h,"key-columns":"customerContact",company:r.value.company},null,8,["company"])]),_:1})),c.value?f("",!0):(d(),u(m,{key:2,label:"合同",name:"contract"},{default:s(()=>[n(X,{ref_key:"contractRef",ref:D,"key-columns":"customerContract"},null,512)]),_:1})),c.value?f("",!0):(d(),u(m,{key:3,label:"操作记录",name:"operate"},{default:s(()=>[n(Z,{ref_key:"recordsRef",ref:g},null,512)]),_:1})),o.value?.userId===$.value&&o.value.shareUserId?(d(),u(m,{key:4,label:"分享详情",name:"share"},{default:s(()=>[n(ee,{ref_key:"shareInfoRef",ref:x,"user-ids":o.value.shareUserId,"onUpdate:userIds":a[2]||(a[2]=t=>o.value.shareUserId=t),disabled:y.disabled||I.value,"customer-id":r.value.id,onChange:J},null,8,["user-ids","disabled","customer-id"])]),_:1})):f("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}});export{ne as _};
