import{d as q,l as r,c as C,o as l,f as p,i as Z,F as z,b as M,e as m,r as v,g as u,v as x,t as O,h as c,D as F,E as ee,s as L,z as j,q as ae,L as U}from"./index-CJ8aW7xe.js";import{_ as te}from"./index.vue_vue_type_script_setup_true_lang-VapWMtmV.js";import{f as E}from"./formData-CpCk6IDZ.js";import{_ as le,a as se}from"./index.vue_vue_type_script_setup_true_lang-m9-1MyAI.js";import{_ as oe}from"./index.vue_vue_type_script_setup_true_lang-B4379ZEP.js";const ne={key:0},re={key:1},ue={key:2,style:{"padding-top":"15px"}},de=q({__name:"shareInfo",props:{userIds:{},customerId:{},disabled:{type:Boolean}},emits:["update:userIds","change"],setup(R,{expose:T,emit:w}){const b=R,d=w,f=r([]),y=()=>{b.userIds&&F("userListByIds",{ids:b.userIds}).then(a=>{f.value=a.data})},_=(a,o)=>{f.value.splice(o,1);const i=f.value.map(k=>k.id).join(",");s(i,"share")},s=(a,o)=>{F("customerShare",{ids:b.customerId,userId:a,type:o}).then(i=>{ee.success("操作成功"),d("update:userIds",a),a===""&&d("change")})};return T({getData:y}),(a,o)=>{const i=v("el-tag"),k=v("el-button");return l(),C("div",null,[a.userIds==="0"?(l(),C("div",ne,"当前客户已共享给所有人")):f.value?(l(),C("div",re,[o[1]||(o[1]=Z("p",null,"当前客户已共享给:",-1)),(l(!0),C(z,null,M(f.value,(g,V)=>(l(),m(i,{key:g.id,closable:!a.disabled,style:{"margin-right":"5px"},onClose:B=>_(g,V)},{default:u(()=>[x(O(g.userName),1)]),_:2},1032,["closable","onClose"]))),128))])):p("",!0),a.disabled?p("",!0):(l(),C("div",ue,[c(k,{type:"danger",onClick:o[0]||(o[0]=g=>s("","cancelShare"))},{default:u(()=>o[2]||(o[2]=[x("取消分享")])),_:1,__:[2]})]))])}}}),ve=q({__name:"detailTabs",props:{disabled:{type:Boolean},tabsType:{}},setup(R,{expose:T}){const w=R,b=L(()=>w.tabsType==="share2"),d=r({}),f=r(),y=r("detail"),_=r(!1),s=r({}),a=r(!0),o=r(),i=r(),k=()=>{_.value=!1,i.value&&i.value(),j(()=>{d.value={},y.value="detail",D.value=[],i.value=void 0})},g=(e,t,I)=>{_.value=!0,a.value=e,s.value=t,i.value=I,e?o.value="新增客户":(o.value=t.company+"详情",j(()=>{f.value.getData({id:t.id})}))},V=r(),B=r(),S=r(),$=r(),A=e=>{switch(e){case"follow":S.value.getData();break;case"contact":V.value.getData();break;case"contract":B.value.getData();break;case"operate":K();break;case"share":$.value.getData();break}},G=(e,t)=>(["add","update"].includes(t)&&e.area&&(e.area=e.area.join(",")),e),H=(e,t,I)=>(["add","update"].includes(I)?k():I==="detail"&&(e.lastTime=U(s.value.lastTime),e.nextTime=U(s.value.nextTime),e.area&&(e.area=e.area.split(","))),e),J=L(()=>a.value?E.filter(e=>e.visible!=="isDetailForm"):E),D=r([]),K=()=>{s.value.id&&D.value.length===0&&F("customerRecords",{tid:s.value.id}).then(e=>{D.value=e.data.list||[]})},P=()=>{y.value="detail"};return T({openDrawer:g}),(e,t)=>{const I=v("ak-form"),h=v("el-tab-pane"),Q=v("el-timeline-item"),W=v("el-timeline"),X=v("el-tabs"),Y=v("el-drawer");return l(),m(Y,{modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=n=>_.value=n),size:"88%",title:o.value,"before-close":k},{default:u(()=>[c(X,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=n=>y.value=n),onTabChange:A},{default:u(()=>[c(h,{label:"客户详情",name:"detail"},{default:u(()=>[c(I,{ref_key:"formRef",ref:f,pk:"id","label-width":"100",class:"flex-form flex-form-2",onCancel:k,after:H,data:J.value,before:G,disabled:e.disabled||b.value,api:{detail:"customerDetail",add:"customerSave",edit:"customerEdit"},modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=n=>d.value=n)},{files:u(({rows:n})=>[_.value?(l(),m(le,{key:0,prop:n.prop,label:n.label,modelValue:d.value.files,"onUpdate:modelValue":t[0]||(t[0]=N=>d.value.files=N)},null,8,["prop","label","modelValue"])):p("",!0)]),_:1},8,["data","disabled","modelValue"])]),_:1}),a.value?p("",!0):(l(),m(h,{key:0,label:"跟进记录",name:"follow"},{default:u(()=>[c(oe,{disabled:e.disabled,"is-components":!0,ref_key:"followRef",ref:S,keyColumns:"customerFollow",customerId:s.value.id,company:s.value.company},null,8,["disabled","customerId","company"])]),_:1})),a.value?p("",!0):(l(),m(h,{key:1,label:"联系人",name:"contact"},{default:u(()=>[c(te,{keyColumns:"customerContact",disabled:e.disabled||b.value,isComponents:!0,tid:s.value.id,company:s.value.company,ref_key:"contactRef",ref:V},null,8,["disabled","tid","company"])]),_:1})),a.value?p("",!0):(l(),m(h,{key:2,label:"合同",name:"contract"},{default:u(()=>[c(se,{isComponents:!0,cId:s.value.id,ref_key:"contractRef",ref:B},null,8,["cId"])]),_:1})),a.value?p("",!0):(l(),m(h,{key:3,label:"操作记录",name:"operate"},{default:u(()=>[c(W,null,{default:u(()=>[(l(!0),C(z,null,M(D.value,(n,N)=>(l(),m(Q,{key:N,timestamp:n.userName+n.content},{default:u(()=>[x(O(ae(U)(n.dataTime)),1)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})),d.value.shareUserId?(l(),m(h,{key:4,label:"分享详情",name:"share"},{default:u(()=>[c(de,{disabled:e.disabled||b.value,ref_key:"shareInfoRef",ref:$,userIds:d.value.shareUserId,"onUpdate:userIds":t[2]||(t[2]=n=>d.value.shareUserId=n),"customer-id":s.value.id,onChange:P},null,8,["disabled","userIds","customer-id"])]),_:1})):p("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}});export{ve as _};
