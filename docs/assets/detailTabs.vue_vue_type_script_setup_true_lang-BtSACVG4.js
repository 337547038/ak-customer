import{d as O,r as n,e as g,o as s,j as p,b as te,F as P,f as q,g as c,a as v,w as r,h as S,D as U,E as le,c as f,t as A,m as se,z as R,B as M,J as N,v as oe,L as ne}from"./index-BiMixNdo.js";import{_ as re}from"./index.vue_vue_type_script_setup_true_lang-BiLbihzO.js";import{f as z}from"./formData-CGcRpgm-.js";import{_ as ue,a as de}from"./index.vue_vue_type_script_setup_true_lang-Gj_WI4Z-.js";import{_ as ie}from"./index.vue_vue_type_script_setup_true_lang-CnTo7G4Z.js";const me={key:0},ce={key:1},fe={key:2,style:{"padding-top":"15px"}},pe=O({__name:"shareInfo",props:{userIds:{},customerId:{},disabled:{type:Boolean}},emits:["update:userIds","change"],setup(w,{expose:x,emit:I}){const h=w,V=I,i=n([]),u=()=>{h.userIds&&U("userListByIds",{ids:h.userIds}).then(l=>{i.value=l.data})},T=(l,a)=>{i.value.splice(a,1);const d=i.value.map(_=>_.id).join(",");b(d,"share")},b=(l,a)=>{U("customerShare",{ids:h.customerId,userId:l,type:a}).then(()=>{le.success("操作成功"),V("update:userIds",l),l===""&&V("change")})};return x({getData:u}),(l,a)=>{const d=v("el-tag"),_=v("el-button");return s(),g("div",null,[l.userIds==="0"?(s(),g("div",me," 当前客户已共享给所有人 ")):i.value?(s(),g("div",ce,[a[1]||(a[1]=te("p",{style:{"padding-bottom":"15px"}}," 当前客户已共享给: ",-1)),(s(!0),g(P,null,q(i.value,(m,C)=>(s(),f(d,{key:m.id,closable:!l.disabled,style:{"margin-right":"5px"},onClose:F=>T(m,C)},{default:r(()=>[S(A(m.userName),1)]),_:2},1032,["closable","onClose"]))),128))])):p("",!0),l.disabled?p("",!0):(s(),g("div",fe,[c(_,{type:"danger",onClick:a[0]||(a[0]=m=>b("","cancelShare"))},{default:r(()=>[...a[2]||(a[2]=[S(" 取消分享 ",-1)])]),_:1})]))])}}}),ge=O({__name:"detailTabs",props:{disabled:{type:Boolean},tabsType:{default:""}},setup(w,{expose:x}){const I=w,h=se(),V=R(()=>h.userInfo?.id),i=R(()=>I.tabsType==="shareWithMe"),u=n({}),T=n(),b=n("detail"),l=n(!1),a=n({}),d=n(!0),_=n(),m=n(),C=()=>{l.value=!1,m.value&&m.value(),M(()=>{u.value={},b.value="detail",D.value=[],m.value=void 0})},F=(e,t,y)=>{l.value=!0,d.value=e,a.value=t,m.value=y,e?_.value="新增客户":(_.value=t.company+"详情",M(()=>{T.value.getData({id:t.id})}))},J=R(()=>({userId:a.value.userId,customerId:a.value.id,isComponents:!0,tabsName:I.tabsType,disabled:I.disabled||i.value}));ne("detailTabsProps",J);const $=n(),L=n(),j=n(),E=n(),W=e=>{switch(e){case"follow":j.value.getData();break;case"contact":$.value.getData();break;case"contract":L.value.getData();break;case"operate":Q();break;case"share":E.value.getData();break}},G=(e,t)=>(["add","update"].includes(t)&&e.area&&(e.area=e.area.join(",")),e),H=(e,t,y)=>(["add","update"].includes(y)?C():y==="detail"&&(e.lastTime=N(a.value.lastTime),e.nextTime=N(a.value.nextTime),e.area&&(e.area=e.area.split(","))),e),K=R(()=>d.value?z.filter(e=>e.visible!=="isDetailForm"):z),D=n([]),Q=()=>{a.value.id&&D.value.length===0&&U("customerRecords",{tid:a.value.id}).then(e=>{D.value=e.data.list||[]})},X=()=>{b.value="detail"};return x({openDrawer:F}),(e,t)=>{const y=v("ak-form"),k=v("el-tab-pane"),Y=v("el-timeline-item"),Z=v("el-timeline"),ee=v("el-tabs"),ae=v("el-drawer");return s(),f(ae,{modelValue:l.value,"onUpdate:modelValue":t[4]||(t[4]=o=>l.value=o),size:"88%",title:_.value,"before-close":C},{default:r(()=>[c(ee,{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=o=>b.value=o),onTabChange:W},{default:r(()=>[c(k,{label:"客户详情",name:"detail"},{default:r(()=>[c(y,{ref_key:"formRef",ref:T,modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=o=>u.value=o),pk:"id","label-width":"100",class:"flex-form flex-form-2",after:H,data:K.value,before:G,disabled:e.disabled||i.value,api:{detail:"customerDetail",add:"customerSave",edit:"customerEdit"},onCancel:C},{files:r(({rows:o})=>[l.value?(s(),f(ue,{key:0,modelValue:u.value.files,"onUpdate:modelValue":t[0]||(t[0]=B=>u.value.files=B),prop:o.prop,label:o.label},null,8,["modelValue","prop","label"])):p("",!0)]),_:1},8,["modelValue","data","disabled"])]),_:1}),d.value?p("",!0):(s(),f(k,{key:0,label:"跟进记录",name:"follow"},{default:r(()=>[c(ie,{ref_key:"followRef",ref:j,"key-columns":"customerFollow",company:a.value.company},null,8,["company"])]),_:1})),d.value?p("",!0):(s(),f(k,{key:1,label:"联系人",name:"contact"},{default:r(()=>[c(re,{ref_key:"contactRef",ref:$,"key-columns":"customerContact",company:a.value.company},null,8,["company"])]),_:1})),d.value?p("",!0):(s(),f(k,{key:2,label:"合同",name:"contract"},{default:r(()=>[c(de,{ref_key:"contractRef",ref:L,"key-columns":"customerContract"},null,512)]),_:1})),d.value?p("",!0):(s(),f(k,{key:3,label:"操作记录",name:"operate"},{default:r(()=>[c(Z,null,{default:r(()=>[(s(!0),g(P,null,q(D.value,(o,B)=>(s(),f(Y,{key:B,timestamp:o.userName+o.content},{default:r(()=>[S(A(oe(N)(o.dataTime)),1)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})),u.value?.userId===V.value&&u.value.shareUserId?(s(),f(k,{key:4,label:"分享详情",name:"share"},{default:r(()=>[c(pe,{ref_key:"shareInfoRef",ref:E,"user-ids":u.value.shareUserId,"onUpdate:userIds":t[2]||(t[2]=o=>u.value.shareUserId=o),disabled:e.disabled||i.value,"customer-id":a.value.id,onChange:X},null,8,["user-ids","disabled","customer-id"])]),_:1})):p("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}});export{ge as _};
