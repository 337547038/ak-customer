import{d as F,l as s,e as I,o as x,g as i,w as N,a as q,r as m,h as a,v as E,i as $,D as L,E as C,k as j,s as V,c as W,F as z,f as A}from"./index-CJ8aW7xe.js";import{c as B,a as G}from"./columns-DW-WqIRL.js";import{_ as H}from"./detailTabs.vue_vue_type_script_setup_true_lang-CAMFkiZY.js";import{_ as J}from"./index.vue_vue_type_style_index_0_lang-CdkKJpQ9.js";import"./index.vue_vue_type_script_setup_true_lang-Y6NzzlyQ.js";import"./areas-c4JLuV3N.js";import"./getCityByCode-DzjNnDGo.js";import"./index.vue_vue_type_script_setup_true_lang-VapWMtmV.js";import"./index.vue_vue_type_script_setup_true_lang-_AmnQ_dk.js";import"./validate-BQpdx7O0.js";import"./formData-CpCk6IDZ.js";import"./index.vue_vue_type_script_setup_true_lang-m9-1MyAI.js";import"./selectContact.vue_vue_type_script_setup_true_lang-m3T1-wYp.js";import"./paymentForm.vue_vue_type_script_setup_true_lang-DdCrYLi6.js";import"./index.vue_vue_type_script_setup_true_lang-B4379ZEP.js";const K=F({__name:"import",setup(T,{expose:S}){const u=s(!1),c=s(!1),o=s(),d=s(),h=s([]),D=t=>{const l=new FormData;l.append("file",t.file),u.value=!0,L("customerImport",l).then(()=>{u.value=!1,d.value&&d.value(),f(),C.success("导入成功")}).catch(()=>{u.value=!1,C.error("导入失败")})},f=()=>{o.value.clearFiles(),c.value=!1,d.value=""},b=()=>{o.value.submit()};return S({openDialog:t=>{c.value=!0,d.value=t}}),(t,l)=>{const k=m("el-button"),v=m("el-upload"),_=m("el-form-item"),w=m("el-form"),y=m("el-dialog"),R=q("loading");return x(),I(y,{width:"500",modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=e=>c.value=e),title:"导入客户","before-close":f},{default:i(()=>[N((x(),I(w,null,{default:i(()=>[a(_,{label:"请选择xlsx文件"},{default:i(()=>[a(v,{accept:".xlsx","auto-upload":!1,ref_key:"uploadRef",ref:o,"file-list":h.value,"onUpdate:fileList":l[0]||(l[0]=e=>h.value=e),"http-request":D},{trigger:i(()=>[a(k,{type:"primary"},{default:i(()=>l[2]||(l[2]=[E("选择文件")])),_:1,__:[2]})]),_:1},8,["file-list"])]),_:1}),a(_,{class:"form-item-flex"},{default:i(()=>[a(k,{type:"primary",onClick:b},{default:i(()=>l[3]||(l[3]=[E("确定")])),_:1,__:[3]}),a(k,{onClick:f},{default:i(()=>l[4]||(l[4]=[E("取消")])),_:1,__:[4]})]),_:1}),a(_,{class:"form-item-flex"},{default:i(()=>l[5]||(l[5]=[$("a",{href:"/template.xlsx"},"下载导入模板",-1)])),_:1,__:[5]})]),_:1})),[[R,u.value]])]),_:1},8,["modelValue"])}}}),ue=F({__name:"index",setup(T){const S=j(),u=s(),c=s(!1),o=s("default"),d=V(()=>S.userInfo?.hasChild),h=e=>{l()},D=V(()=>o.value==="child"?[...B.slice(0,3),G,...B.slice(3)]:B),f=s(),b=s(),p=s([]),t=s(),l=()=>{b.value.getData()},k=V(()=>o.value==="shareWithMe"?[]:[{key:"add",click:()=>{y(!0)}},{key:"import",label:"导入",click:()=>{f.value.openDialog(l)},icon:"icon-import"},{key:"toUser",label:"移交",icon:"icon-toUser",click:e=>{c.value=!1,u.value.open(),p.value=e,t.value="toUser"},disabled:e=>!e?.length},{key:"toCom",label:"转入公海",icon:"icon-toCom",disabled:e=>!e?.length,click:e=>{p.value=e,t.value="toCom",v({})},render:"confirm",popConfirm:{title:"确认将所选客户转入公海吗？",width:300}},{key:"share",label:"共享客户",icon:"icon-share",disabled:e=>!e?.length,display:()=>o.value==="default",click:e=>{c.value=!0,p.value=e,t.value="myShare",u.value.open()}},{key:"cancelShare",label:"取消共享",icon:"icon-share",disabled:e=>!e?.length,display:()=>o.value==="myShare",click:e=>{p.value=e,t.value="cancelShare",v({})}},{key:"toInvalid",label:"设为无效客户",icon:"icon-invalid",render:"confirm",popConfirm:{title:"确认将所选客户设置为无效客户吗？",width:300},disabled:e=>!e?.length,click:e=>{p.value=e,t.value="toInvalid",v({})}}]),v=e=>{const n=p.value?.map(r=>r.id).join(",");if(t.value==="myShare"||t.value==="cancelShare"){let r="";t.value==="myShare"&&(r=e==="all"?"0":e.map(g=>g.id).join(",")),L("customerShare",{ids:n,userId:r,type:t.value}).then(g=>{C.success("操作成功"),b.value.table?.clearSelection(),t.value==="cancelShare"&&l()})}else L("customerMove",{ids:n,userId:e.id,type:t.value}).then(r=>{C.success("操作成功"),l()}).catch(()=>{})},_=s(),w=(e,n)=>(e==="get"&&(n.extend.columns="contact",o.value!=="default"&&(n.extend.search=o.value)),n),y=(e,n)=>{_.value.openDrawer(e,n||{},l)},R=(e,n,r)=>{if(e==="row")switch(n.key){case"detail":y(!1,r);break}};return(e,n)=>{const r=m("el-tab-pane"),g=m("el-tabs"),U=m("ak-list");return x(),W(z,null,[a(g,{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=M=>o.value=M),class:"demo-tabs",onTabChange:h},{default:i(()=>[a(r,{label:"我的客户",name:"default"}),d.value?(x(),I(r,{key:0,label:"下属客户",name:"child"})):A("",!0),a(r,{label:"共享客户",name:"shareWithMe"}),a(r,{label:"我共享的",name:"myShare"})]),_:1},8,["modelValue"]),a(U,{ref_key:"tableListEl",ref:b,pk:"id",columns:D.value,api:{list:"customerList",export:"customerExport"},controlBtn:k.value,before:w,onEventClick:R},null,8,["columns","controlBtn"]),a(H,{ref_key:"detailTableRef",ref:_,tabsType:o.value},null,8,["tabsType"]),a(K,{ref_key:"importDialogRef",ref:f},null,512),a(J,{ref_key:"userDialogRef",ref:u,showInput:!1,multiple:c.value,onSelectClick:v},null,8,["multiple"])],64)}}});export{ue as default};
