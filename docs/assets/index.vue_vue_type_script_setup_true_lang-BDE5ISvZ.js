import{_ as I}from"./index.vue_vue_type_script_setup_true_lang-CvW6n_1L.js";import{v as r}from"./validate-DWWidr2n.js";import{d as O,a6 as P,E as t,k as R,q as D,Q as Y,c as S,h as f,n as b,g as U,J as B,r as v,o as $}from"./index-DuawtOAE.js";const W=O({__name:"index",props:{company:{default:""},keyColumns:{default:""}},setup(h,{expose:_}){const M=h,l=P("detailTabsProps",t({})),g=R(),T=[{key:"add",click:()=>{x(!0)},display:()=>!l.value.disabled}],k=t(),o=t(!1),s=t("新增联系人"),w=t(),i=t({decisionMaker:1,sex:1}),n=t(!1),V=(e,a)=>(e==="get"&&l.value.isComponents&&(a.tid=l.value.customerId,a.userId=l.value.userId,l.value.tabsName==="shareWithMe"&&(a.specialCustomer=l.value.customerId,a.extend.search="comInvalidShare")),a),x=(e,a)=>{o.value=!0,n.value=!e,e?s.value=`新增${M.company||""}联系人`:(s.value=`编辑${a?.name}信息`,B(()=>{w.value.getData({id:a.id})}))},d=D(()=>!l.value.isComponents),q=D(()=>l.value.isComponents?l.value.tabsName==="child":g.userInfo?.hasChild),p=t(),y={1:"是",2:"否",3:"未知"},E=t([{prop:"checked",type:"selection"},{label:"所属人员",prop:"userId",visible:!1,search:{changeRefresh:!0,style:{width:"230px"},visible:q,render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0,onChange:e=>{p.value=e}}},{label:"客户名称",prop:"tid",search:{userId:p,visible:d,render:"component",component:Y(I)},formatter:e=>e.company,visible:d,width:160,showOverflowTooltip:!0},{label:"联系人",prop:"name",width:80},{label:"是否决策人",prop:"decisionMaker",render:"tag",replaceValue:y,custom:{1:"success",2:"primary",3:"warning"},search:!1,width:95},{label:"手机",prop:"phone"},{label:"性别",prop:"sex",render:"tag",replaceValue:"sex",search:!1,width:60},{label:"微信",prop:"weixin"},{label:"电话",prop:"tel",search:!1},{label:"QQ",prop:"qq",search:!1},{label:"电子邮件",prop:"email",search:!1},{label:"职位",prop:"position",search:!1},{prop:"creatDate",label:"创建时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"lastTime",label:"最后联系时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"nextTime",label:"下次联系时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{visible:()=>!l.value.disabled,fixed:"right",prop:"operate",label:"操作",render:"buttons",width:"120px",search:!1,buttons:[{key:"edit",label:"编辑",attr:{text:!0},click:e=>{x(!1,e)}},{key:"del",label:"删除",icon:"",attr:{text:!0}}]}]),c=()=>{o.value=!1,i.value={decisionMaker:1,sex:1}},H=(e,a)=>(a==="add"&&l.value.isComponents&&(e.tid=l.value.customerId),e),L=(e,a,u)=>(["add","update"].includes(u)&&(c(),C()),e),Q=t([{label:"客户名称",prop:"tid",attr:{style:{width:"350px"},userId:p},render:"component",component:Y(I),visible:d,formItem:{rules:[r("required","客户名称不能为空")]}},{label:"姓名",prop:"name",formItem:{rules:[r("required","姓名不能为空")]}},{label:"手机",prop:"phone",formItem:{rules:[r("mobile"),r("required","请输入手机号")]}},{label:"职务",prop:"position"},{label:"电话",prop:"tel",formItem:{rules:[r("tel")]}},{label:"微信号",prop:"weixin"},{label:"QQ",prop:"qq"},{label:"电子邮件",prop:"email",formItem:{rules:[r("email")]}},{label:"是否决策人",prop:"decisionMaker",render:"radio",options:y},{label:"性别",prop:"sex",render:"radio",options:"sex"},{label:"生日",prop:"birthday",render:"datePicker",attr:{valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD"}},{label:"地址",prop:"address"},{label:"最后联系时间",prop:"lastTime",attr:{disabled:!0},visible:n},{label:"下次跟进时间",prop:"nextTime",render:"datePicker",attr:{type:"datetime",valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss"}},{label:"创建时间",prop:"creatDate",attr:{disabled:!0},visible:n},{label:"备注",prop:"remark",attr:{style:{width:"100%"},type:"textarea",rows:3}}]),C=()=>{k.value.getData()};return _({getData:C}),(e,a)=>{const u=v("ak-list"),F=v("ak-form"),N=v("el-dialog");return $(),S("div",null,[f(u,{ref_key:"tableListEl",ref:k,pk:"id",columns:E.value,api:{list:"contactList",del:"contactDel"},"control-btn":T,before:V,"show-search":!b(l).disabled,"columns-icon-visible":!b(l).disabled,"auto-load":!b(l).isComponents,"key-columns":h.keyColumns},null,8,["columns","show-search","columns-icon-visible","auto-load","key-columns"]),f(N,{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=m=>o.value=m),width:"800",title:s.value,class:"form-dialog","before-close":c},{default:U(()=>[f(F,{ref_key:"formRef",ref:w,modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=m=>i.value=m),pk:"id",data:Q.value,"label-width":"100",class:"flex-form flex-form-2",api:{detail:"contactGet",add:"contactSave",edit:"contactEdit"},after:L,before:H,onCancel:c},null,8,["modelValue","data"])]),_:1},8,["modelValue","title"])])}}});export{W as _};
