import{_ as x}from"./index.vue_vue_type_script_setup_true_lang-_AmnQ_dk.js";import{v as o}from"./validate-BQpdx7O0.js";import{d as F,k as N,l,s as C,I as D,c as O,h as f,g as Q,z as R,r as b,o as U}from"./index-CJ8aW7xe.js";const j=F({__name:"index",props:{isComponents:{type:Boolean,default:!1},tid:{},company:{},disabled:{type:Boolean},keyColumns:{},tabsName:{}},setup(Y,{expose:g}){const t=Y,I=N(),M=[{key:"add",click:()=>{w(!0)},display:()=>!t.disabled}],h=l(),r=l(!1),s=l("新增联系人"),v=l(),i=l({decisionMaker:1,sex:1}),n=l(!1),_=(e,a)=>(e==="get"&&t.isComponents&&(a.tid=t.tid),a),w=(e,a)=>{r.value=!0,n.value=!e,e?s.value=`新增${t.company||""}联系人`:(s.value=`编辑${a?.name}信息`,R(()=>{v.value.getData({id:a.id})}))},p=C(()=>!t.isComponents),V=C(()=>t.isComponents?t.tabsName==="child":I.userInfo?.hasChild),d=l(),k={1:"是",2:"否",3:"未知"},T=l([{prop:"checked",type:"selection"},{label:"所属人员",prop:"userId",show:!1,search:{changeRefresh:!0,style:{width:"230px"},visible:V,render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0,onChange:e=>{d.value=e}}},{label:"客户名称",prop:"tid",search:{userId:d,visible:p,render:"component",component:D(x)},formatter:e=>e.company,show:p,width:160,showOverflowTooltip:!0},{label:"联系人",prop:"name",width:80},{label:"是否决策人",prop:"decisionMaker",render:"tag",replaceValue:k,custom:{1:"success",2:"primary",3:"warning"},search:!1,width:95},{label:"手机",prop:"phone"},{label:"性别",prop:"sex",render:"tag",replaceValue:"sex",search:!1,width:60},{label:"微信",prop:"weixin"},{label:"电话",prop:"tel",search:!1},{label:"QQ",prop:"qq",search:!1},{label:"电子邮件",prop:"email",search:!1},{label:"职位",prop:"position",search:!1},{prop:"creatDate",label:"创建时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"lastTime",label:"最后联系时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"nextTime",label:"下次联系时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{show:!t.disabled,fixed:"right",prop:"operate",label:"操作",render:"buttons",width:"120px",search:!1,buttons:[{key:"edit",label:"编辑",attr:{text:!0},click:e=>{w(!1,e)}},{key:"del",label:"删除",icon:"",attr:{text:!0}}]}]),c=()=>{r.value=!1,i.value={decisionMaker:1,sex:1}},q=(e,a)=>(a==="add"&&t.isComponents&&(e.tid=t.tid),e),E=(e,a,m)=>(["add","update"].includes(m)&&(c(),y()),e),H=l([{label:"客户名称",prop:"tid",attr:{style:{width:"350px"},userId:d},render:"component",component:D(x),visible:p,formItem:{rules:[o("required","客户名称不能为空")]}},{label:"姓名",prop:"name",formItem:{rules:[o("required","姓名不能为空")]}},{label:"手机",prop:"phone",formItem:{rules:[o("mobile"),o("required","请输入手机号")]}},{label:"职务",prop:"position"},{label:"电话",prop:"tel",formItem:{rules:[o("tel")]}},{label:"微信号",prop:"weixin"},{label:"QQ",prop:"qq"},{label:"电子邮件",prop:"email",formItem:{rules:[o("email")]}},{label:"是否决策人",prop:"decisionMaker",render:"radio",options:k},{label:"性别",prop:"sex",render:"radio",options:"sex"},{label:"生日",prop:"birthday",render:"datePicker",attr:{valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD"}},{label:"地址",prop:"address"},{label:"最后联系时间",prop:"lastTime",attr:{disabled:!0},visible:n},{label:"下次跟进时间",prop:"nextTime",render:"datePicker",attr:{type:"datetime",valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss"}},{label:"创建时间",prop:"creatDate",attr:{disabled:!0},visible:n},{label:"备注",prop:"remark",attr:{style:{width:"100%"},type:"textarea",rows:3}}]),y=()=>{h.value.getData()};return g({getData:y}),(e,a)=>{const m=b("ak-list"),L=b("ak-form"),B=b("el-dialog");return U(),O("div",null,[f(m,{ref_key:"tableListEl",ref:h,pk:"id",columns:T.value,api:{list:"contactList",del:"contactDel"},controlBtn:M,before:_,"show-search":!e.disabled,columnsIconVisible:!e.disabled,"auto-load":!e.isComponents,keyColumns:e.keyColumns},null,8,["columns","show-search","columnsIconVisible","auto-load","keyColumns"]),f(B,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=u=>r.value=u),width:"800",title:s.value,class:"form-dialog","before-close":c},{default:Q(()=>[f(L,{pk:"id",ref_key:"formRef",ref:v,data:H.value,"label-width":"100",class:"flex-form flex-form-2",api:{detail:"contactGet",add:"contactSave",edit:"contactEdit"},onCancel:c,after:E,before:q,modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=u=>i.value=u)},null,8,["data","modelValue"])]),_:1},8,["modelValue","title"])])}}});export{j as _};
