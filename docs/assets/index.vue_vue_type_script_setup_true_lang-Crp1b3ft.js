import{_ as S}from"./index.vue_vue_type_script_setup_true_lang-DyiyRsDp.js";import{d as W,v as l,l as G,M as z,e as Y,o as C,r as u,g as i,h as m,i as oe,B as T,E as re,z as A,J as se,k as ne,q as H,G as L,H as $,c as ue,n as N,N as de,F as ce,f as U,s as j,t as ie,j as me}from"./index-BqO2u9IT.js";import{v as c}from"./validate-DWZH7t8y.js";import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang-DAATMvvn.js";import{_ as fe}from"./paymentForm.vue_vue_type_script_setup_true_lang-DQg-5VD8.js";const ve=["src"],he=W({__name:"upload",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(B,{emit:F}){const a=B,V=F,r=l([]),p=l(""),f=l(!1),M=G(()=>a.modelValue,()=>{if(a.modelValue){const o=a.modelValue.split(",");r.value=[],o.forEach(s=>{r.value.push({url:s})})}}),v=()=>{A(()=>{const o=r.value.length?r.value.map(s=>s.url).join(","):"";V("update:modelValue",o)})},w=o=>{T("uploadDel",{path:o.url}),v()},I=o=>{p.value=o.url,f.value=!0},y=o=>{const s=new FormData;s.append("file",o.file),T("upload",s).then(({data:h})=>{r.value.forEach(d=>{d.uid===o.file?.uid&&(d.url=h)}),v()}).catch(()=>{r.value.forEach((h,d)=>{h.uid===o.file?.uid&&r.value.splice(d,1)}),v(),re.error(`${o.file.name}上传失败`)})};return z(()=>{M()}),(o,s)=>{const h=u("Plus"),d=u("el-icon"),x=u("el-upload"),b=u("el-dialog"),D=u("el-form-item");return C(),Y(D,{style:{width:"100%"}},{default:i(()=>[m(x,{"file-list":r.value,"onUpdate:fileList":s[0]||(s[0]=_=>r.value=_),"http-request":y,"list-type":"picture-card","on-preview":I,"on-remove":w},{default:i(()=>[m(d,null,{default:i(()=>[m(h)]),_:1})]),_:1},8,["file-list"]),m(b,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=_=>f.value=_)},{default:i(()=>[oe("img",{"w-full":"",src:p.value,alt:"Preview Image"},null,8,ve)]),_:1},8,["modelValue"])]),_:1})}}}),De=W({__name:"index",props:{keyColumns:{default:""}},setup(B,{expose:F}){const a=se("detailTabsProps",l({})),V=me(),r=ne(),p=l(!1),f=l(),M=H(()=>a.value.isComponents?a.value.tabsName==="child":r.userInfo?.hasChild),v=H(()=>!a.value.isComponents),w=l(),I=l(),y=l(),o=[{key:"add",click:()=>{D()},display:()=>!a.value.disabled}],s=l([{label:"所属人员",prop:"userId",visible:!1,search:{changeRefresh:!0,style:{width:"230px"},visible:M,render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0}},{prop:"id",label:"ID",search:!1,width:50},{prop:"code",label:"合同编号"},{prop:"name",label:"合同名称"},{prop:"customerId",label:"客户名称",width:180,showOverflowTooltip:!0,formatter:e=>e.customerName,search:{render:"component",userId:I,visible:v,component:L(S)},visible:v},{prop:"money",label:"合同金额",search:!1,width:110},{prop:"payment",label:"已收款项",search:!1,width:110},{prop:"contactId",label:"公司签约人",search:!1,formatter:e=>e.contactName,width:100},{prop:"startDate",label:"合同有效期",search:{render:"datePicker",type:"daterange",startPlaceholder:"开始时间",endPlaceholder:"结束时间",valueFormat:"YYYY-MM-DD"},formatter:e=>$(e.startDate,"{y}-{m}-{d}")+" / "+$(e.endDate,"{y}-{m}-{d}"),width:180},{prop:"creatDate",label:"创建时间",render:"date",search:!1,width:100},{prop:"status",label:"状态",render:"tag",replaceValue:{1:"待审核",2:"已确认",3:"未通过"},custom:{2:"success",3:"danger"},search:{render:"select",options:{1:"待审核",2:"已确认",3:"未通过"}},width:"90px"},{visible:()=>!a.value.disabled,prop:"operate",label:"操作",render:"buttons",width:210,fixed:"right",buttons:[{label:"审核",attr:{type:"danger",text:!0},display:e=>r.userInfo?.hasChild&&e.userId!==r.userInfo?.id&&e.status===1,click:e=>{D(e,!0)}},{label:"收款",attr:{type:"success",text:!0},click:e=>{w.value.open(!1,e)}},{key:"edit",label:"详情",attr:{text:!0},click:e=>{D(e)}},{key:"del",label:"删除",attr:{text:!0}}],search:!1}]),h=(e,t,g)=>{e==="userId"&&r.userInfo?.hasChild&&(g.customerId=null,I.value=t)},d=(e,t)=>(e==="get"&&(t.startEndDate&&(t.startDate=t.startEndDate[0],t.endDate=t.startEndDate[1],delete t.startEndDate),a.value.customerId&&(t.customerId=a.value.customerId),t.userId=a.value.userId,V.query.search==="todo"&&(t.extend.search="child"),a.value.tabsName==="shareWithMe"&&(t.specialCustomer=a.value.customerId,t.extend.search="comInvalidShare")),t),x=l(!1),b=l(!1),D=(e,t)=>{p.value=!1,b.value=!0,q.value="新增合同",e&&(q.value=t?"审批合同":"修改合同",x.value=!!t,A(()=>{I.value||(p.value=e.status===2),y.value=e.userId,_.value.getData({id:e.id}),R.value=e.customerId}))},_=l(),k=l({}),q=l("新增合同"),R=l(),J=l([{label:"客户名称",prop:"customerId",render:"component",component:L(S),visible:v,formItem:{rules:[c("required","客户名称不能为空","change")]},attr:{userId:y}},{label:"合同名称",prop:"name",formItem:{rules:[c("required","合同名称不能为空","change")]}},{label:"合同编码",prop:"code",formItem:{rules:[c("required","合同编码不能为空","change")]}},{label:"公司签约人",prop:"contactId",attr:{placeholder:"请输入联系人,可使用%",customerId:R,userId:y},render:"component",component:L(pe),formItem:{rules:[c("required","公司签约人不能为空","change")]}},{label:"合同金额",prop:"money",formItem:{rules:[c("required","合同金额不能为空","change"),c("money")]}},{label:"合同开始时间",prop:"startDate",render:"datePicker",attr:{valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD"},formItem:{rules:[c("required","合同开始时间不能为空","change")]}},{label:"合同结束时间",prop:"endDate",render:"datePicker",attr:{valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD"},formItem:{rules:[c("required","合同结束时间不能为空","change")]}},{label:"审核",prop:"status",render:"select",options:[{value:1,label:"待审核"},{value:2,label:"通过"},{value:3,label:"拒绝"}],visible:x},{label:"备注",prop:"remark",attr:{style:{width:"100%"},type:"textarea",rows:4}},{prop:"files",label:"合同附件",render:"scope",formItem:{rules:[{required:!0,message:"请输入合同附件"}]}}]),P=()=>{b.value=!1,k.value={},_.value.resetFields()},O=(e,t)=>(t==="add"&&a.value.isComponents&&(e.customerId=a.value.customerId),e),K=(e,t,g)=>(["add","update"].includes(g)&&(P(),f.value.getData()),e),Q=(e,t,g)=>{e==="customerId"&&(g.contactId=null,R.value=t)},X=e=>e.startDate<new Date&&e.endDate>new Date,E=()=>{f.value.getData()},Z=G(()=>V.query,()=>{E()});return z(()=>{Z()}),F({getData:E}),(e,t)=>{const g=u("el-tag"),ee=u("el-alert"),te=u("ak-form"),ae=u("el-dialog");return C(),ue(ce,null,[m(de,{ref_key:"tableListRef",ref:f,pk:"id",columns:s.value,"show-search":!N(a).disabled,api:{list:"contractList",del:"contractDel"},"control-btn":o,"auto-load":!N(a).isComponents,"columns-icon-visible":!N(a).disabled,"key-columns":e.keyColumns,before:d,onFormFieldChange:h},{code:i(({row:n})=>[X(n)?(C(),Y(g,{key:0,type:"danger"},{default:i(()=>[...t[3]||(t[3]=[j(" 已过期 ",-1)])]),_:1})):U("",!0),j(" "+ie(n.name),1)]),_:1},8,["columns","show-search","auto-load","columns-icon-visible","key-columns"]),m(ae,{modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=n=>b.value=n),width:"800",title:q.value,class:"form-dialog","before-close":P},{default:i(()=>[p.value?(C(),Y(ee,{key:0,title:"审核通过，不能修改数据",type:"success"})):U("",!0),m(te,{ref_key:"formRef",ref:_,modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=n=>k.value=n),disabeld:p.value,pk:"id",data:J.value,"label-width":"110",class:"flex-form flex-form-2",api:{detail:"contractGet",add:"contractSave",edit:"contractEdit"},after:K,before:O,onCancel:P,onChange:Q},{files:i(({rows:n})=>[b.value?(C(),Y(he,{key:0,modelValue:k.value.files,"onUpdate:modelValue":t[0]||(t[0]=le=>k.value.files=le),rules:n.formItem.rules,prop:n.prop,label:n.label},null,8,["modelValue","rules","prop","label"])):U("",!0)]),_:1},8,["modelValue","disabeld","data"])]),_:1},8,["modelValue","title"]),m(fe,{ref_key:"paymentFormRef",ref:w,onCallback:E},null,512)],64)}}});export{he as _,De as a};
