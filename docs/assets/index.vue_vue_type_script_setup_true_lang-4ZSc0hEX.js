import{_ as B}from"./index.vue_vue_type_script_setup_true_lang-BGeArx4B.js";import{d as A,E as l,l as G,a3 as J,e as C,o as g,r as c,g as i,h as m,n as V,U as oe,i as re,R as $,T as se,J as O,a7 as ne,k as ue,q as j,Q as N,S as H,c as de,P as ce,a8 as ie,f as S,x as W,t as me,j as pe}from"./index-CNiyTwfQ.js";import{v as d}from"./validate-BPUuIrlQ.js";import{_ as fe}from"./index.vue_vue_type_script_setup_true_lang-DZJ_mQBD.js";import{_ as ve}from"./paymentForm.vue_vue_type_script_setup_true_lang-DZ5FNQgC.js";import he from"./wap-CzR0Kd7f.js";const be=["src"],_e=A({__name:"upload",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(M,{emit:q}){const a=M,x=q,r=l([]),p=l(""),f=l(!1),F=G(()=>a.modelValue,()=>{if(a.modelValue){const o=a.modelValue.split(",");r.value=[],o.forEach(s=>{r.value.push({url:s})})}}),v=()=>{O(()=>{const o=r.value.length?r.value.map(s=>s.url).join(","):"";x("update:modelValue",o)})},w=o=>{$("uploadDel",{path:o.url}),v()},y=o=>{p.value=o.url,f.value=!0},k=o=>{const s=new FormData;s.append("file",o.file),$("upload",s).then(({data:h})=>{r.value.forEach(u=>{u.uid===o.file?.uid&&(u.url=h)}),v()}).catch(()=>{r.value.forEach((h,u)=>{h.uid===o.file?.uid&&r.value.splice(u,1)}),v(),se.error(`${o.file.name}上传失败`)})};return J(()=>{F()}),(o,s)=>{const h=c("el-icon"),u=c("el-upload"),Y=c("el-dialog"),b=c("el-form-item");return g(),C(b,{style:{width:"100%"}},{default:i(()=>[m(u,{"file-list":r.value,"onUpdate:fileList":s[0]||(s[0]=_=>r.value=_),"http-request":k,"list-type":"picture-card","on-preview":y,"on-remove":w},{default:i(()=>[m(h,null,{default:i(()=>[m(V(oe))]),_:1})]),_:1},8,["file-list"]),m(Y,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=_=>f.value=_)},{default:i(()=>[re("img",{"w-full":"",src:p.value,alt:"Preview Image"},null,8,be)]),_:1},8,["modelValue"])]),_:1})}}}),Ie={key:0},xe=A({__name:"index",props:{keyColumns:{default:""}},setup(M,{expose:q}){const a=ne("detailTabsProps",l({})),x=pe(),r=ue(),p=l(!1),f=l(),F=j(()=>a.value.isComponents?a.value.tabsName==="child":r.userInfo?.hasChild),v=j(()=>!a.value.isComponents),w=l(),y=l(),k=l(),o=[{key:"add",click:()=>{_()},display:()=>!a.value.disabled}],s=l([{label:"所属人员",prop:"userId",visible:!1,search:{changeRefresh:!0,style:{width:"230px"},visible:F,render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0}},{prop:"id",label:"ID",search:!1,width:50},{prop:"code",label:"合同编号"},{prop:"name",label:"合同名称"},{prop:"customerId",label:"客户名称",width:180,showOverflowTooltip:!0,formatter:e=>e.customerName,search:{render:"component",userId:y,visible:v,component:N(B)},visible:v},{prop:"money",label:"合同金额",search:!1,width:110},{prop:"payment",label:"已收款项",search:!1,width:110},{prop:"contactId",label:"公司签约人",search:!1,formatter:e=>e.contactName,width:100},{prop:"startEndDate",label:"合同有效期",search:{render:"datePicker",type:"daterange",startPlaceholder:"开始时间",endPlaceholder:"结束时间",valueFormat:"YYYY-MM-DD"},formatter:e=>H(e.startDate,"{y}-{m}-{d}")+" / "+H(e.endDate,"{y}-{m}-{d}"),width:180},{prop:"creatDate",label:"创建时间",render:"date",search:!1,width:100},{prop:"status",label:"状态",render:"tag",replaceValue:{1:"待审核",2:"已确认",3:"未通过"},custom:{2:"success",3:"danger"},search:{render:"select",options:{1:"待审核",2:"已确认",3:"未通过"}},width:"90px"},{visible:()=>!a.value.disabled,prop:"operate",label:"操作",render:"buttons",width:210,fixed:"right",buttons:[{label:"审核",attr:{type:"danger",text:!0},display:e=>r.userInfo?.hasChild&&e.userId!==r.userInfo?.id&&e.status===1,click:e=>{_(e,!0)}},{label:"收款",attr:{type:"success",text:!0},click:e=>{w.value.open(!1,e)}},{key:"edit",label:"详情",attr:{text:!0},click:e=>{_(e)}},{key:"del",label:"删除",attr:{text:!0}}],search:!1}]),h=(e,t,I)=>{e==="userId"&&r.userInfo?.hasChild&&(I.customerId=null,y.value=t)},u=(e,t)=>(e==="get"&&(t.startEndDate&&(t.startDate=t.startEndDate[0],t.endDate=t.startEndDate[1],delete t.startEndDate),a.value.customerId&&(t.customerId=a.value.customerId),t.userId=t.userId||a.value.userId,x.query.search==="todo"&&(t.extend.search="child"),a.value.tabsName==="shareWithMe"&&(t.specialCustomer=a.value.customerId,t.extend.search="comInvalidShare")),t),Y=l(!1),b=l(!1),_=(e,t)=>{p.value=!1,b.value=!0,E.value="新增合同",e&&(E.value=t?"审批合同":"修改合同",Y.value=!!t,O(()=>{y.value||(p.value=e.status===2),k.value=e.userId,R.value.getData({id:e.id}),P.value=e.customerId}))},R=l(),D=l({}),E=l("新增合同"),P=l(),T=l([{label:"客户名称",prop:"customerId",render:"component",component:N(B),visible:v,formItem:{rules:[d("required","客户名称不能为空","change")]},attr:{userId:k}},{label:"合同名称",prop:"name",formItem:{rules:[d("required","合同名称不能为空","change")]}},{label:"合同编码",prop:"code",formItem:{rules:[d("required","合同编码不能为空","change")]}},{label:"公司签约人",prop:"contactId",attr:{placeholder:"请输入联系人,可使用%",customerId:P,userId:k},render:"component",component:N(fe),formItem:{rules:[d("required","公司签约人不能为空","change")]}},{label:"合同金额",prop:"money",formItem:{rules:[d("required","合同金额不能为空","change"),d("money")]}},{label:"合同开始时间",prop:"startDate",render:"datePicker",attr:{valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD"},formItem:{rules:[d("required","合同开始时间不能为空","change")]}},{label:"合同结束时间",prop:"endDate",render:"datePicker",attr:{valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD"},formItem:{rules:[d("required","合同结束时间不能为空","change")]}},{label:"审核",prop:"status",render:"select",options:[{value:1,label:"待审核"},{value:2,label:"通过"},{value:3,label:"拒绝"}],visible:Y},{label:"备注",prop:"remark",attr:{style:{width:"100%"},type:"textarea",rows:4}},{prop:"files",label:"合同附件",render:"scope",formItem:{rules:[{required:!0,message:"请输入合同附件"}]}}]),L=()=>{b.value=!1,D.value={},R.value.resetFields()},Q=(e,t)=>(t==="add"&&a.value.isComponents&&(e.customerId=a.value.customerId),e),z=(e,t,I)=>(["add","update"].includes(I)&&(L(),f.value.getData()),e),K=(e,t,I)=>{e==="customerId"&&(I.contactId=null,P.value=t)},X=e=>e.startDate<new Date&&e.endDate>new Date,U=()=>{f.value.getData()},Z=G(()=>x.query,()=>{U()});return J(()=>{Z()}),q({getData:U}),(e,t)=>{const I=c("el-tag"),ee=c("el-alert"),te=c("ak-form"),ae=c("el-dialog");return V(ce)()?(g(),C(he,{key:1,"form-data":T.value},null,8,["form-data"])):(g(),de("div",Ie,[m(ie,{ref_key:"tableListRef",ref:f,pk:"id",columns:s.value,"show-search":!V(a).disabled,api:{list:"contractList",del:"contractDel"},"control-btn":o,"auto-load":!V(a).isComponents,"columns-icon-visible":!V(a).disabled,"key-columns":M.keyColumns,before:u,onFormFieldChange:h},{code:i(({row:n})=>[X(n)?(g(),C(I,{key:0,type:"danger"},{default:i(()=>[...t[3]||(t[3]=[W(" 已过期 ",-1)])]),_:1})):S("",!0),W(" "+me(n.code),1)]),_:1},8,["columns","show-search","auto-load","columns-icon-visible","key-columns"]),m(ae,{modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=n=>b.value=n),width:"800",title:E.value,class:"form-dialog","before-close":L},{default:i(()=>[p.value?(g(),C(ee,{key:0,title:"审核通过，不能修改数据",type:"success"})):S("",!0),m(te,{ref_key:"formRef",ref:R,modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=n=>D.value=n),disabeld:p.value,pk:"id",data:T.value,"label-width":"110",class:"flex-form flex-form-2",api:{detail:"contractGet",add:"contractSave",edit:"contractEdit"},after:z,before:Q,onCancel:L,onChange:K},{files:i(({rows:n})=>[b.value?(g(),C(_e,{key:0,modelValue:D.value.files,"onUpdate:modelValue":t[0]||(t[0]=le=>D.value.files=le),rules:n.formItem.rules,prop:n.prop,label:n.label},null,8,["modelValue","rules","prop","label"])):S("",!0)]),_:1},8,["modelValue","disabeld","data"])]),_:1},8,["modelValue","title"]),m(ve,{ref_key:"paymentFormRef",ref:w,onCallback:U},null,512)]))}}});export{_e as _,xe as a};
