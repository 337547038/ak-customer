import{d as E,k as K,E as c,m as P,c as w,n as W,P as j,i as n,h as t,g as u,R as p,j as D,u as F,r,Z as G,J,Y,o as x,x as V,_ as Z,ac as k}from"./index-CkpV00AO.js";import{W as z,w as H}from"./wWx-BJhC-L6q.js";const O={key:0,class:"container"},Q={class:"form"},X=["src"],$={class:"weixin",style:{padding:"10px 0"}},ee={key:1,class:"login-page"},oe={class:"box"},te=["src"],se={style:{margin:"16px"}},h=E({__name:"index",setup(ae){const y=F(),m=D(),q=K(),b=c(),C=()=>{b.value.open()},_=(o,e)=>{e?(G("resources",!0),q.setLoginInfo(o,!0),L(o.roleId).then(()=>{const s=m.query.redirect?m.query.redirect:"/";J(()=>{y.push({path:s})})})):d()},L=o=>new Promise(e=>{if(!o)return e();p("roleGetByIds",{id:o}).then(s=>{const f=s.data;Y("resources",f,0),e()})}),i=c({userName:"admin",password:"123456"}),I=c([{prop:"userName",label:"用户名",formItem:{rules:[{required:!0,message:"请输入用户名",trigger:"blur"}]},attr:{}},{prop:"password",label:"密码",formItem:{rules:[{required:!0,message:"请输入密码",trigger:"blur"}]},attr:{type:"password"}}]),g=c(),d=()=>{p("getCaptcha",{}).then(o=>{const{base64:e,codeId:s}=o.data;g.value="data:image/png;base64,"+e,i.value.codeId=s,l.value.codeId=s}).catch(()=>{})},N=()=>{const o=m.query.code,e=m.query.state;o&&e&&p("scanLogin",{code:o}).then(s=>{_(s.data,!0)}).catch(()=>{y.push({path:"/login",query:{redirect:"/system/usercenter"}}),d()})},l=c({userName:"admin",password:"123456",code:"",codeId:""}),R=()=>{H()},S=()=>{p("userLogin",l.value).then(o=>{_(o.data,!0)}).catch(()=>{d()})};return P(()=>{d(),N()}),(o,e)=>{const s=r("el-input"),f=r("el-form-item"),U=r("ak-form"),B=r("el-button"),v=r("van-field"),A=r("van-cell-group"),M=r("van-button"),T=r("van-form");return W(j)()?(x(),w("div",ee,[n("div",oe,[t(T,{onSubmit:S},{default:u(()=>[e[8]||(e[8]=n("div",{class:"h1"}," AK客户管理系统 ",-1)),t(A,{inset:""},{default:u(()=>[t(v,{modelValue:l.value.userName,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.userName=a),name:"username",label:"用户名",placeholder:"用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),t(v,{modelValue:l.value.password,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.password=a),type:"password",name:"password",label:"密码",placeholder:"密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"]),t(v,{modelValue:l.value.code,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.code=a),name:"password",label:"验证码",placeholder:"验证码",rules:[{required:!0,message:"请填写验证码"}]},{button:u(()=>[n("img",{src:g.value,class:"img",alt:"获取验证码",onClick:d},null,8,te)]),_:1},8,["modelValue"])]),_:1}),n("div",se,[t(M,{round:"",block:"",type:"primary","native-type":"submit"},{default:u(()=>[...e[7]||(e[7]=[V(" 登录 ",-1)])]),_:1})]),n("div",{class:"login-type",onClick:R}," 使用微信登录 ")]),_:1})])])):(x(),w("div",O,[n("div",Q,[e[6]||(e[6]=n("h3",null,"AK客户管理系统",-1)),t(U,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),"label-width":"100",data:I.value,api:{add:"userLogin"},after:_},{default:u(()=>[t(f,{label:"验证码",class:"item-code"},{default:u(()=>[t(s,{modelValue:i.value.code,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value.code=a),placeholder:"输入验证码"},null,8,["modelValue"]),n("img",{src:g.value,class:"img",alt:"获取验证码",onClick:d},null,8,X)]),_:1})]),_:1},8,["modelValue","data"]),n("div",$,[t(B,{type:"primary",text:"",onClick:C},{default:u(()=>[...e[5]||(e[5]=[V(" 微信扫码登录 ",-1)])]),_:1})]),t(z,{ref_key:"wxLoginRef",ref:b},null,512)])]))}}});typeof k=="function"&&k(h);const re=Z(h,[["__scopeId","data-v-f5cdc8ff"]]);export{re as default};
