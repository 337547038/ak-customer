import{_ as C}from"./index.vue_vue_type_script_setup_true_lang-lWq4qB80.js";import{v as o}from"./validate-BQpdx7O0.js";import{d as P,N as Q,l as t,k as R,s as I,I as _,c as U,h as f,q as b,g as B,z as S,r as h,o as $}from"./index-D_PG1Bnj.js";const A=P({__name:"index",props:{company:{},keyColumns:{}},setup(D,{expose:Y}){const g=D,l=Q("detailTabsProps",t({})),M=R(),T=[{key:"add",click:()=>{k(!0)},display:()=>!l.value.disabled}],v=t(),r=t(!1),s=t("新增联系人"),w=t(),i=t({decisionMaker:1,sex:1}),n=t(!1),V=(e,a)=>(e==="get"&&l.value.isComponents&&(a.tid=l.value.coustomerId,a.userId=l.value.userId),a),k=(e,a)=>{r.value=!0,n.value=!e,e?s.value=`新增${g.company||""}联系人`:(s.value=`编辑${a?.name}信息`,S(()=>{w.value.getData({id:a.id})}))},p=I(()=>!l.value.isComponents),q=I(()=>l.value.isComponents?l.value.tabsName==="child":M.userInfo?.hasChild),d=t(),x={1:"是",2:"否",3:"未知"},E=t([{prop:"checked",type:"selection"},{label:"所属人员",prop:"userId",show:!1,search:{changeRefresh:!0,style:{width:"230px"},visible:q,render:"select",ajax:{api:"userChildList",data:{},label:"userName",value:"id"},clearable:!0,onChange:e=>{d.value=e}}},{label:"客户名称",prop:"tid",search:{userId:d,visible:p,render:"component",component:_(C)},formatter:e=>e.company,show:p,width:160,showOverflowTooltip:!0},{label:"联系人",prop:"name",width:80},{label:"是否决策人",prop:"decisionMaker",render:"tag",replaceValue:x,custom:{1:"success",2:"primary",3:"warning"},search:!1,width:95},{label:"手机",prop:"phone"},{label:"性别",prop:"sex",render:"tag",replaceValue:"sex",search:!1,width:60},{label:"微信",prop:"weixin"},{label:"电话",prop:"tel",search:!1},{label:"QQ",prop:"qq",search:!1},{label:"电子邮件",prop:"email",search:!1},{label:"职位",prop:"position",search:!1},{prop:"creatDate",label:"创建时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"lastTime",label:"最后联系时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{prop:"nextTime",label:"下次联系时间",render:"datetime",search:!1,width:120,showOverflowTooltip:!0},{show:!l.value.disabled,fixed:"right",prop:"operate",label:"操作",render:"buttons",width:"120px",search:!1,buttons:[{key:"edit",label:"编辑",attr:{text:!0},click:e=>{k(!1,e)}},{key:"del",label:"删除",icon:"",attr:{text:!0}}]}]),c=()=>{r.value=!1,i.value={decisionMaker:1,sex:1}},H=(e,a)=>(a==="add"&&l.value.isComponents&&(e.tid=l.value.customerId),e),L=(e,a,u)=>(["add","update"].includes(u)&&(c(),y()),e),F=t([{label:"客户名称",prop:"tid",attr:{style:{width:"350px"},userId:d},render:"component",component:_(C),visible:p,formItem:{rules:[o("required","客户名称不能为空")]}},{label:"姓名",prop:"name",formItem:{rules:[o("required","姓名不能为空")]}},{label:"手机",prop:"phone",formItem:{rules:[o("mobile"),o("required","请输入手机号")]}},{label:"职务",prop:"position"},{label:"电话",prop:"tel",formItem:{rules:[o("tel")]}},{label:"微信号",prop:"weixin"},{label:"QQ",prop:"qq"},{label:"电子邮件",prop:"email",formItem:{rules:[o("email")]}},{label:"是否决策人",prop:"decisionMaker",render:"radio",options:x},{label:"性别",prop:"sex",render:"radio",options:"sex"},{label:"生日",prop:"birthday",render:"datePicker",attr:{valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD"}},{label:"地址",prop:"address"},{label:"最后联系时间",prop:"lastTime",attr:{disabled:!0},visible:n},{label:"下次跟进时间",prop:"nextTime",render:"datePicker",attr:{type:"datetime",valueFormat:"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss"}},{label:"创建时间",prop:"creatDate",attr:{disabled:!0},visible:n},{label:"备注",prop:"remark",attr:{style:{width:"100%"},type:"textarea",rows:3}}]),y=()=>{v.value.getData()};return Y({getData:y}),(e,a)=>{const u=h("ak-list"),N=h("ak-form"),O=h("el-dialog");return $(),U("div",null,[f(u,{ref_key:"tableListEl",ref:v,pk:"id",columns:E.value,api:{list:"contactList",del:"contactDel"},controlBtn:T,before:V,"show-search":!b(l).disabled,columnsIconVisible:!b(l).disabled,"auto-load":!b(l).isComponents,keyColumns:e.keyColumns},null,8,["columns","show-search","columnsIconVisible","auto-load","keyColumns"]),f(O,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=m=>r.value=m),width:"800",title:s.value,class:"form-dialog","before-close":c},{default:B(()=>[f(N,{pk:"id",ref_key:"formRef",ref:w,data:F.value,"label-width":"100",class:"flex-form flex-form-2",api:{detail:"contactGet",add:"contactSave",edit:"contactEdit"},onCancel:c,after:L,before:H,modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=m=>i.value=m)},null,8,["data","modelValue"])]),_:1},8,["modelValue","title"])])}}});export{A as _};
