import{d as O,k as Q,E as r,q as D,j as X,e as w,g as c,r as u,o as f,h as d,i as s,t as n,x as Y,c as g,f as ee,Z as te,b as ae,F as oe,S as le,u as re,J as se,_ as ne}from"./index-CNiyTwfQ.js";import{_ as ce}from"./upload.vue_vue_type_script_setup_true_lang-COSkoUoB.js";const ie=["onClick"],ue={key:0},de={class:"ul"},pe={style:{width:"100%"}},me=O({__name:"wap",props:{formData:{}},setup(N){const V=N,B=Q(),h=X(),E=re(),p=r(),b=r([]),L={1:"待审核",2:"已确认",3:"未通过"},R=B.userInfo?.hasChild,x=r(),v=r(),S=D(()=>{const e=[];return V.formData.forEach(t=>{let o=t.render==="radio"?"picker":t.render,i={};switch(t.prop){case"customerId":o="picker",i={picker:{remote:!0,keyword:"company",ajax:{api:"customerList",data:{}},columnsFieldNames:{text:"company",value:"id"}}};break;case"contactId":o="picker",i={picker:{remote:!0,openLoad:!0,keyword:"name",ajax:{api:"contactList",data:{tid:x.value,userId:""}},columnsFieldNames:{text:"name",value:"id"}}};break;case"remark":i={field:{type:"textarea"}};break;case"status":o="picker",i={picker:{columnsFieldNames:{text:"label",value:"value"}}};break}e.push({label:t.label,prop:t.prop,rules:t.formItem?.rules||[],render:o,options:t.options,...i})}),e}),q=e=>{v.value=e},_=(e,t)=>le(e,t==="d"?"{y}-{m}-{d}":"{y}-{m}-{d} {h}:{i}"),P=[{text:"收款",key:"money",type:"success"},{text:"编辑",key:"edit",type:"primary"},{text:"删除",key:"del",type:"danger"}],$=(e,t)=>{t==="del"?p.value.deleteById(e.id):t==="edit"?(k.value=`编辑：${e.name} 信息`,I(e)):E.push({path:"/contract/payment",query:{id:e.id}})},C=r(),T=r([{label:"所属人员",prop:"userId",render:"picker",visible:()=>R,field:{clearable:!0},picker:{ajax:{api:"userChildList",data:{}},columnsFieldNames:{text:"userName",value:"id"}}},{prop:"code",label:"合同编号"},{prop:"name",label:"合同名称"},{label:"客户名称",prop:"customerId",field:{clearable:!0},render:"picker",modelValue:h.query.id,picker:{remote:!0,openLoad:!0,keyword:"company",ajax:{api:"customerList",data:{userId:C}},columnsFieldNames:{text:"company",value:"id"}}},{prop:"startEndDate",label:"合同有效期",render:"datePicker",datePicker:{type:"dateRange",startPlaceholder:"合同开始时间",endPlaceholder:"合同结束时间"}},{prop:"status",label:"状态",render:"picker",options:{1:"待审核",2:"已确认",3:"未通过"}}]),U=(e,t,o)=>{e==="userId"&&(o.customerId=""),C.value=t},m=r(!0),k=r("新增合同"),j=e=>{e==="add"&&(m.value=!0)},A=e=>{if(e.customerId||(e.customerId=h.query.id),e.startEndDate){const t=e.startEndDate.split(",");e.startDate=t[0],e.endDate=t[1],delete e.startEndDate}return e},F=r(),I=e=>{m.value=!1,k.value="编辑合同",y(!0),se(()=>{F.value.getData({id:e.id})})},W=D(()=>m.value?["status"]:[]),z=(e,t,o)=>{e==="customerId"&&(o.contactId="",x.value=t)},y=e=>{p.value.showForm(e)},G=e=>(v.value&&(e.files=v.value),e),J=e=>{e==="submit"&&(p.value.onRefresh(),y(!1))};return(e,t)=>{const o=u("van-collapse-item"),i=u("van-button"),M=u("van-swipe-cell"),Z=u("w-form"),H=u("w-list"),K=u("van-collapse");return f(),w(K,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a)},{default:c(()=>[d(H,{ref_key:"listRef",ref:p,api:{get:"contractList",del:"contractDel"},"search-form-data":T.value,"add-icon-visible":!0,"form-title":k.value,before:A,onSearchFormChange:U,onNavBarEvent:j},{item:c(({data:a})=>[d(M,null,{right:c(()=>[(f(!0),g(oe,null,ae(P.filter(l=>l.visible!==!1),l=>(f(),w(i,{key:l.key,square:"",color:l.color,type:l.type,text:l.text,size:"small",onClick:fe=>$(a,l.key)},null,8,["color","type","text","onClick"]))),128))]),default:c(()=>[d(o,{name:a.id,value:a.code},{title:c(()=>[s("div",{onClick:te(l=>I(a),["stop"])},[Y(n(a.name)+" ",1),a.position?(f(),g("span",ue,"("+n(a.position)+")",1)):ee("",!0)],8,ie)]),default:c(()=>[s("ul",de,[s("li",null,"客户名称："+n(a.customerName),1),s("li",null,"合同金额："+n(a.money),1),s("li",null,"公司签约人："+n(a.contactName),1),s("li",null,"已收款项："+n(a.payment||0),1),s("li",null,"创建时间："+n(_(a.creatDate)),1),s("li",null,"状态："+n(L[a.status]),1),s("li",pe," 合同有效期："+n(_(a.startDate,"d")+" / "+_(a.endDate,"d")),1)])]),_:2},1032,["name","value"])]),_:2},1024)]),default:c(()=>[d(Z,{ref_key:"formRef",ref:F,data:S.value,"submit-url":m.value?"contractSave":"contractEdit","request-url":"contractGet",before:G,after:J,"hide-filed":W.value,onCancel:y,onFieldValueChange:z},{files:c(({rows:a,value:l})=>[d(ce,{item:a,"model-value":l,"onUpdate:modelValue":q},null,8,["item","model-value"])]),_:1},8,["data","submit-url","hide-filed"])]),_:1},8,["search-form-data","form-title"])]),_:1},8,["modelValue"])}}}),ke=ne(me,[["__scopeId","data-v-46ae49c4"]]);export{ke as default};
